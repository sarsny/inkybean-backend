# InkyBean iOS App Backend å¼€å‘æ–‡æ¡£

**ç‰ˆæœ¬**: 1.6.3  
**æœ€åæ›´æ–°**: 2025-10-16

## Overview

InkyBean iOS App åç«¯æœåŠ¡æ˜¯ä¸€ä¸ªåŸºäº Node.js + Express + Supabase çš„ RESTful API æœåŠ¡ï¼Œä¸º iOS åº”ç”¨æä¾›ç”¨æˆ·è®¤è¯ã€ä¹¦ç±ç®¡ç†ã€é¢˜ç›®è·å–å’Œå­¦ä¹ è¿›åº¦è·Ÿè¸ªåŠŸèƒ½ã€‚

### æŠ€æœ¯æ ˆ
- **Runtime**: Node.js
- **Framework**: Express.js
- **Database**: Supabase (PostgreSQL)
- **Authentication**: Supabase Auth + JWT
- **Validation**: Joi
- **Security**: Helmet, CORS, Rate Limiting

### æ ¸å¿ƒåŠŸèƒ½
- ç”¨æˆ·æ³¨å†Œå’Œç™»å½•è®¤è¯
- ä¹¦ç±åˆ—è¡¨è·å–ï¼ˆå«è…èš€åº¦è®¡ç®—ï¼‰
- é¢˜ç›®è·å–å’Œéšæœºæ’åº
- å­¦ä¹ è¿›åº¦æäº¤å’Œè·Ÿè¸ª
- åŸºäºè‰¾å®¾æµ©æ–¯é—å¿˜æ›²çº¿çš„è…èš€åº¦è®¡ç®—
- Coze AI å¯¹è¯å’Œæ™ºèƒ½äº¤äº’åŠŸèƒ½

## Database Schema

### 1. books è¡¨
å­˜å‚¨ä¹¦ç±åŸºæœ¬ä¿¡æ¯

| å­—æ®µå | ç±»å‹ | çº¦æŸ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|
| bookId | uuid | PRIMARY KEY | gen_random_uuid() | ä¹¦ç±å”¯ä¸€æ ‡è¯† |
| title | text | NOT NULL | - | ä¹¦ç±æ ‡é¢˜ |
| author | text | NULLABLE | - | ä½œè€… |
| description | text | NULLABLE | - | ä¹¦ç±æè¿° |
| coverImageUrl | text | NULLABLE | - | å°é¢å›¾ç‰‡URL |
| questionCount | integer | NOT NULL | 0 | é¢˜ç›®æ•°é‡ |
| isPublished | boolean | NOT NULL | false | æ˜¯å¦å·²å‘å¸ƒ |
| createdAt | timestamptz | NOT NULL | now() | åˆ›å»ºæ—¶é—´ |
| updatedAt | timestamptz | NOT NULL | now() | æ›´æ–°æ—¶é—´ |

**æ³¨æ„**: è¯¥è¡¨ç»“æ„å·²ä¼˜åŒ–ï¼Œç§»é™¤äº† `isbn`ã€`publisher`ã€`publishDate`ã€`authorIntro`ã€`url` ç­‰å­—æ®µï¼Œä¿æŒæ ¸å¿ƒå­—æ®µçš„ç®€æ´æ€§ã€‚

### 2. questions è¡¨
å­˜å‚¨é¢˜ç›®ä¿¡æ¯

| å­—æ®µå | ç±»å‹ | çº¦æŸ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|
| questionId | uuid | PRIMARY KEY | gen_random_uuid() | é¢˜ç›®å”¯ä¸€æ ‡è¯† |
| bookId | uuid | FOREIGN KEY | - | å…³è”ä¹¦ç±ID |
| statement | text | NOT NULL | - | é¢˜ç›®é™ˆè¿° |
| imageUrl | text | NULLABLE | - | é¢˜ç›®å›¾ç‰‡URL |
| isPure | boolean | NOT NULL | - | æ˜¯å¦ä¸ºçº¯å‡€é¢˜ç›® |
| explanation | text | NOT NULL | - | é¢˜ç›®è§£é‡Š |
| createdAt | timestamptz | NOT NULL | now() | åˆ›å»ºæ—¶é—´ |
| updatedAt | timestamptz | NOT NULL | now() | æ›´æ–°æ—¶é—´ |

### 3. user_progress è¡¨
å­˜å‚¨ç”¨æˆ·å­¦ä¹ è¿›åº¦

| å­—æ®µå | ç±»å‹ | çº¦æŸ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|
| progressId | uuid | PRIMARY KEY | gen_random_uuid() | è¿›åº¦è®°å½•å”¯ä¸€æ ‡è¯† |
| userId | uuid | FOREIGN KEY | - | ç”¨æˆ·ID (å…³è” auth.users) |
| bookId | uuid | FOREIGN KEY | - | ä¹¦ç±ID |
| lastAttemptedAt | timestamptz | NULLABLE | - | æœ€åå­¦ä¹ æ—¶é—´ |
| highestAccuracy | float8 | NOT NULL | 0 | æœ€é«˜æ­£ç¡®ç‡ (0-1) |
| totalAttempts | integer | NOT NULL | 0 | æ€»å°è¯•æ¬¡æ•° |
| createdAt | timestamptz | NOT NULL | now() | åˆ›å»ºæ—¶é—´ |
| updatedAt | timestamptz | NOT NULL | now() | æ›´æ–°æ—¶é—´ |

### 4. themes è¡¨
å­˜å‚¨ä¹¦ç±ä¸»é¢˜ä¿¡æ¯ï¼ˆç”¨äºAIé¢˜ç›®ç”Ÿæˆï¼‰

| å­—æ®µå | ç±»å‹ | çº¦æŸ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|
| id | uuid | PRIMARY KEY | gen_random_uuid() | ä¸»é¢˜å”¯ä¸€æ ‡è¯† |
| bookId | uuid | FOREIGN KEY | - | å…³è”ä¹¦ç±ID |
| themeText | text | NOT NULL | - | ä¸»é¢˜æ–‡æœ¬å†…å®¹ |
| createdAt | timestamptz | NOT NULL | now() | åˆ›å»ºæ—¶é—´ |

### 5. questions è¡¨
å­˜å‚¨é¢˜ç›®ä¿¡æ¯

| å­—æ®µå | ç±»å‹ | çº¦æŸ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|
| questionId | uuid | PRIMARY KEY | gen_random_uuid() | é¢˜ç›®å”¯ä¸€æ ‡è¯†ç¬¦ |
| bookId | uuid | FOREIGN KEY | - | å…³è”çš„ä¹¦ç±IDï¼Œå¼•ç”¨booksè¡¨ |
| statement | text | NOT NULL | - | é¢˜ç›®é™ˆè¿° |
| imageUrl | text | NULLABLE | - | é¢˜ç›®é…å›¾URL |
| isPure | boolean | NOT NULL | - | æ˜¯å¦ä¸ºçº¯æ–‡æœ¬é¢˜ç›® |
| explanation | text | NOT NULL | - | é¢˜ç›®è§£é‡Šè¯´æ˜ |
| themeId | uuid | FOREIGN KEY | - | å…³è”çš„ä¸»é¢˜IDï¼Œå¼•ç”¨themesè¡¨ |
| createdAt | timestamptz | NOT NULL | now() | åˆ›å»ºæ—¶é—´ |
| updatedAt | timestamptz | NOT NULL | now() | æ›´æ–°æ—¶é—´ |

### 6. dialogues è¡¨
å­˜å‚¨å¯¹è¯å†…å®¹ï¼ˆæ‰©å±•åŠŸèƒ½ï¼‰

| å­—æ®µå | ç±»å‹ | çº¦æŸ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|
| id | uuid | PRIMARY KEY | gen_random_uuid() | å¯¹è¯å”¯ä¸€æ ‡è¯† |
| dialogueId | text | UNIQUE | - | å¯¹è¯ID |
| context | text | NOT NULL | - | å¯¹è¯ä¸Šä¸‹æ–‡ |
| condition | text | NULLABLE | - | å¯¹è¯æ¡ä»¶ |
| texts | text[] | NOT NULL | - | å¯¹è¯æ–‡æœ¬æ•°ç»„ |
| version | text | NOT NULL | '1.0.0' | ç‰ˆæœ¬å· |
| createdAt | timestamptz | NOT NULL | now() | åˆ›å»ºæ—¶é—´ |
| updatedAt | timestamptz | NOT NULL | now() | æ›´æ–°æ—¶é—´ |

## API Endpoints

### è®¤è¯æ¥å£ (`/auth`)

#### POST /auth/register
ç”¨æˆ·æ³¨å†Œ

**è¯·æ±‚ä½“:**
```json
{
  "email": "user@example.com",
  "password": "password123"
}
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "message": "User registered successfully",
  "user": {
    "id": "uuid",
    "email": "user@example.com",
    "createdAt": "2024-01-01T00:00:00Z"
  },
  "token": "jwt_token_here"
}
```

#### POST /auth/login
ç”¨æˆ·ç™»å½•

**è¯·æ±‚ä½“:**
```json
{
  "email": "user@example.com",
  "password": "password123"
}
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "message": "Login successful",
  "user": {
    "id": "uuid",
    "email": "user@example.com",
    "lastSignInAt": "2024-01-01T00:00:00Z"
  },
  "token": "jwt_token_here"
}
```

### ä¹¦ç±æ¥å£ (`/books`)

#### POST /books
æ·»åŠ æ–°ä¹¦ç±ï¼ˆé€šè¿‡ Coze AI å·¥ä½œæµè·å–ä¹¦ç±ä¿¡æ¯ï¼‰

**Headers:**
```
Authorization: Bearer <JWT_TOKEN>
```

**è¯·æ±‚ä½“:**
```json
{
  "title": "æ¸¸æˆæ”¹å˜ä¸–ç•Œ"
}
```

**å·¥ä½œæµç¨‹:**
1. **å‚æ•°éªŒè¯**: éªŒè¯ä¹¦åä¿¡æ¯ï¼ˆä¸éœ€è¦æä¾›ä½œè€…ï¼‰
2. **é‡å¤æ£€æŸ¥**: æ£€æŸ¥ä¹¦ç±æ˜¯å¦å·²å­˜åœ¨äºæ•°æ®åº“ä¸­
3. **AI æŸ¥è¯¢**: è°ƒç”¨ Coze å·¥ä½œæµ API è·å–ä¹¦ç±è¯¦ç»†ä¿¡æ¯
4. **æ•°æ®è§£æ**: è§£æ AI è¿”å›çš„ä¹¦ç±ä¿¡æ¯
   - `book_image` â†’ `coverImageUrl`ï¼ˆå°é¢å›¾ç‰‡ï¼‰
   - `summary` â†’ `description`ï¼ˆä¹¦ç±æè¿°ï¼‰
   - `author` â†’ ä½œè€…ä¿¡æ¯ï¼ˆä» AI è¿”å›ä¸­æå–ï¼‰
5. **æ•°æ®åº“å­˜å‚¨**: å°†ä¹¦ç±ä¿¡æ¯ä¿å­˜åˆ° books è¡¨

**å“åº”ç¤ºä¾‹:**
```json
{
  "message": "ä¹¦ç±æ·»åŠ æˆåŠŸ",
  "book": {
    "bookId": "3f6dae7f-ed34-4d42-8193-d025d175b0fe",
    "title": "æ¸¸æˆæ”¹å˜ä¸–ç•Œ",
    "author": "ç®€Â·éº¦æˆˆå°¼æ ¼å°”",
    "description": "è¿™æ˜¯ä¸€æœ¬å…³äºæ¸¸æˆå¦‚ä½•æ”¹å˜ä¸–ç•Œçš„ä¹¦ç±...",
    "coverImageUrl": "https://example.com/cover.jpg",
    "questionCount": 0,
    "createdAt": "2025-10-16T06:45:23.007352+00:00",
    "updatedAt": "2025-10-16T06:45:23.007352+00:00"
  }
}
```

**é”™è¯¯ç :**
- `INVALID_TITLE`: ä¹¦åä¸èƒ½ä¸ºç©ºæˆ–æ ¼å¼é”™è¯¯
- `COZE_API_ERROR`: Coze å·¥ä½œæµè°ƒç”¨å¤±è´¥æˆ–è¿”å›æ•°æ®æ ¼å¼é”™è¯¯
- `DATABASE_INSERT_ERROR`: æ•°æ®åº“æ’å…¥å¤±è´¥
- `UNAUTHORIZED`: æœªæˆæƒè®¿é—®

#### GET /books
è·å–ç”¨æˆ·çš„æ‰€æœ‰ä¹¦ç±åˆ—è¡¨åŠå¯¹åº”çš„å­¦ä¹ çŠ¶æ€

**Headers:**
```
Authorization: Bearer <JWT_TOKEN>
```

**å“åº”ç¤ºä¾‹:**
```json
[
  {
    "bookId": "uuid",
    "title": "ã€Šäººç±»ç®€å²ã€‹",
    "author": "å°¤ç“¦å°”Â·èµ«æ‹‰åˆ©",
    "description": "ä¹¦ç±æè¿°",
    "coverImageUrl": "https://example.com/cover.jpg",
    "questionCount": 20,
    "corruptionLevel": 0.75,
    "highestAccuracy": 0.85,
    "totalAttempts": 3,
    "lastAttemptedAt": "2024-01-01T00:00:00Z"
  }
]
```

#### POST /books/:bookId/select
ç”¨æˆ·é€‰æ‹©è¦å·©å›ºçš„ä¹¦ç±ï¼Œåˆ›å»ºç”¨æˆ·ä¸ä¹¦ç±çš„ç»‘å®šå…³ç³»

**Headers:**
```
Authorization: Bearer <JWT_TOKEN>
```

**è·¯å¾„å‚æ•°:**
- `bookId`: ä¹¦ç±å”¯ä¸€æ ‡è¯†ç¬¦ (UUID)

**å·¥ä½œæµç¨‹:**
1. **ä¹¦ç±éªŒè¯**: éªŒè¯ä¹¦ç±æ˜¯å¦å­˜åœ¨ä¸”å·²å‘å¸ƒ
2. **é¢˜ç›®æ£€æŸ¥**: ç¡®ä¿ä¹¦ç±æœ‰å¯ç”¨é¢˜ç›®ï¼ˆquestionCount > 0ï¼‰
3. **é‡å¤æ£€æŸ¥**: æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç»é€‰æ‹©è¿‡è¯¥ä¹¦ç±
4. **åˆ›å»ºè®°å½•**: å¦‚æœæ˜¯é¦–æ¬¡é€‰æ‹©ï¼Œåœ¨ `user_progress` è¡¨ä¸­åˆ›å»ºæ–°è®°å½•
5. **è¿”å›ä¿¡æ¯**: è¿”å›ä¹¦ç±ä¿¡æ¯å’Œç”¨æˆ·è¿›åº¦çŠ¶æ€

**å“åº”ç¤ºä¾‹ (é¦–æ¬¡é€‰æ‹©):**
```json
{
  "message": "ä¹¦ç±é€‰æ‹©æˆåŠŸï¼Œå¼€å§‹å·©å›ºä¹‹æ—…ï¼",
  "userProgress": {
    "progressId": "b744e6d1-49a0-4557-b336-6e84a04000a1",
    "bookId": "caa8bde3-48be-4f3f-b6f0-3f4b7f8862c4",
    "title": "å¹³å‡¡çš„ä¸–ç•Œ",
    "author": "è·¯é¥",
    "questionCount": 10,
    "highestAccuracy": 0,
    "totalAttempts": 0,
    "lastAttemptedAt": null,
    "alreadySelected": false,
    "selectedAt": "2025-10-16T08:48:09.30223+00:00"
  }
}
```

**å“åº”ç¤ºä¾‹ (é‡å¤é€‰æ‹©):**
```json
{
  "message": "æ‚¨å·²ç»é€‰æ‹©è¿‡è¿™æœ¬ä¹¦ç±",
  "userProgress": {
    "progressId": "b744e6d1-49a0-4557-b336-6e84a04000a1",
    "bookId": "caa8bde3-48be-4f3f-b6f0-3f4b7f8862c4",
    "title": "å¹³å‡¡çš„ä¸–ç•Œ",
    "author": "è·¯é¥",
    "questionCount": 10,
    "alreadySelected": true,
    "selectedAt": "2025-10-16T08:48:09.30223+00:00"
  }
}
```

**é”™è¯¯ç :**
- `BOOK_NOT_FOUND`: ä¹¦ç±ä¸å­˜åœ¨æˆ–æœªå‘å¸ƒ
- `NO_QUESTIONS_AVAILABLE`: è¯¥ä¹¦ç±æš‚æ— é¢˜ç›®ï¼Œæ— æ³•å¼€å§‹å·©å›º
- `DATABASE_ERROR`: æ£€æŸ¥ç”¨æˆ·å­¦ä¹ çŠ¶æ€æ—¶å‡ºé”™
- `DATABASE_INSERT_ERROR`: é€‰æ‹©ä¹¦ç±å¤±è´¥
- `UNAUTHORIZED`: æœªæˆæƒè®¿é—®

#### GET /books/:bookId/questions
è·å–ä¸€æœ¬ä¹¦çš„æ‰€æœ‰é¢˜ç›®

**Headers:**
```
Authorization: Bearer <JWT_TOKEN>
```

**æŸ¥è¯¢å‚æ•°:**
- `limit`: é¢˜ç›®æ•°é‡é™åˆ¶ (å¯é€‰ï¼Œé»˜è®¤10)
- `shuffle`: æ˜¯å¦éšæœºæ’åº (å¯é€‰ï¼Œé»˜è®¤true)

**å“åº”ç¤ºä¾‹:**
```json
{
  "book": {
    "bookId": "44b16a72-429a-47ab-9fab-7aab94b341c6",
    "title": "ã€Šäººç±»ç®€å²ã€‹"
  },
  "questions": [
    {
      "questionId": "25b72be2-c2bc-4aaf-b321-060aac9483ab",
      "statement": "æ™ºäººæ˜¯å†å²ä¸Šå”¯ä¸€å­˜åœ¨è¿‡çš„äººç±»ç‰©ç§ã€‚",
      "imageUrl": null,
      "isPure": false,
      "explanation": "é”™è¯¯ã€‚å†å²ä¸Šæ›¾å­˜åœ¨å¤šä¸ªäººç±»ç‰©ç§ï¼Œå¦‚å°¼å®‰å¾·ç‰¹äººã€‚æ™ºäººæœ€ç»ˆèƒœå‡ºå¹¶æˆä¸ºå”¯ä¸€å¹¸å­˜çš„äººç§ã€‚"
    }
  ],
  "totalCount": 1
}
```

**é”™è¯¯ç :**
- `BOOK_NOT_FOUND`: ä¹¦ç±ä¸å­˜åœ¨æˆ–æœªå‘å¸ƒ
- `QUESTIONS_FETCH_ERROR`: è·å–é¢˜ç›®å¤±è´¥
- `UNAUTHORIZED`: æœªæˆæƒè®¿é—®

#### POST /books/:bookId/generate-questions
åŸºäºä¹¦ç±ä¿¡æ¯å’Œç°æœ‰é¢˜ç›®ï¼Œè°ƒç”¨AIæœåŠ¡ç”Ÿæˆæ–°çš„é«˜è´¨é‡é¢˜ç›®

**Headers:**
```
Authorization: Bearer <JWT_TOKEN>
```

**è¯·æ±‚å‚æ•°:**
- `bookId`: ä¹¦ç±UUID (è·¯å¾„å‚æ•°)

**AIç”Ÿæˆå·¥ä½œæµç¨‹:**
1. **æ•°æ®æ”¶é›†é˜¶æ®µ**: è·å–ä¹¦ç±åŸºæœ¬ä¿¡æ¯ï¼ˆæ ‡é¢˜ã€ä½œè€…ï¼‰å’Œç°æœ‰ä¸»é¢˜åˆ—è¡¨
2. **ä¸»é¢˜ç”Ÿæˆé˜¶æ®µ**: ä½¿ç”¨DeepSeek AIåŸºäºä¹¦ç±å†…å®¹ç”Ÿæˆæ–°çš„æ ¸å¿ƒä¸»é¢˜ï¼Œå¹¶ä¿å­˜åˆ°themesè¡¨
3. **è§’åº¦åˆ†é…é˜¶æ®µ**: åç«¯éšæœºä¸ºæ¯ä¸ªä¸»é¢˜åˆ†é…åˆ›æ„è§’åº¦ï¼ˆå¦‚"å®è·µåº”ç”¨"ã€"æ‰¹åˆ¤æ€§æ€è€ƒ"ç­‰ï¼‰
4. **é¢˜ç›®ç”Ÿæˆé˜¶æ®µ**: åŸºäºä¸»é¢˜å’ŒæŒ‡å®šè§’åº¦ç”Ÿæˆå…·ä½“çš„åˆ¤æ–­é¢˜ï¼Œå…³è”å¯¹åº”çš„themeId
5. **æ•°æ®å­˜å‚¨é˜¶æ®µ**: å°†ç”Ÿæˆçš„é¢˜ç›®æ‰¹é‡æ’å…¥æ•°æ®åº“å¹¶æ›´æ–°ä¹¦ç±ç»Ÿè®¡

**å“åº”ç¤ºä¾‹:**
```json
{
  "message": "Questions generated successfully",
  "result": {
    "bookId": "44b16a72-429a-47ab-9fab-7aab94b341c6",
    "bookTitle": "ã€Šäººç±»ç®€å²ã€‹",
    "questions": [
      {
        "questionId": "new-uuid-1",
        "bookId": "44b16a72-429a-47ab-9fab-7aab94b341c6",
        "statement": "è®¤çŸ¥é©å‘½ä½¿æ™ºäººèƒ½å¤Ÿåˆ›é€ è™šæ„çš„æ¦‚å¿µï¼Œå¦‚å®—æ•™ã€è´§å¸å’Œæ³•å¾‹ã€‚",
        "imageUrl": null,
        "isPure": true,
        "explanation": "æ­£ç¡®ã€‚è®¤çŸ¥é©å‘½çº¦å‘ç”Ÿåœ¨7ä¸‡å¹´å‰ï¼Œä½¿æ™ºäººå…·å¤‡äº†åˆ›é€ å’Œç›¸ä¿¡è™šæ„æ¦‚å¿µçš„èƒ½åŠ›ï¼Œè¿™æ˜¯æ™ºäººèƒ½å¤Ÿå¤§è§„æ¨¡åˆä½œçš„å…³é”®ã€‚",
        "createdAt": "2025-01-15T08:00:52.632703+00:00",
        "updatedAt": "2025-01-15T08:00:52.632703+00:00"
      }
    ],
    "totalGenerated": 5,
    "newQuestionCount": 8
  }
}
```

**é”™è¯¯ç :**
- `BOOK_NOT_FOUND`: ä¹¦ç±ä¸å­˜åœ¨æˆ–æœªå‘å¸ƒ
- `QUESTIONS_FETCH_ERROR`: è·å–ç°æœ‰é¢˜ç›®å¤±è´¥
- `AI_SERVICE_ERROR`: AIæœåŠ¡è°ƒç”¨å¤±è´¥
- `INVALID_AI_RESPONSE`: AIè¿”å›æ•°æ®æ ¼å¼æ— æ•ˆ
- `QUESTIONS_INSERT_ERROR`: é¢˜ç›®æ’å…¥æ•°æ®åº“å¤±è´¥
- `UNAUTHORIZED`: æœªæˆæƒè®¿é—®

### è¿›åº¦æ¥å£ (`/progress`)

#### POST /books/:bookId/submit
ç”¨æˆ·å®Œæˆä¸€æ¬¡é—¯å…³åï¼Œæäº¤æœ¬æ¬¡ç»“æœ

**Headers:**
```
Authorization: Bearer <JWT_TOKEN>
```

**è¯·æ±‚ä½“:**
```json
{
  "correctCount": 18,
  "totalCount": 20
}
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "message": "Progress submitted successfully",
  "result": {
    "bookId": "uuid",
    "bookTitle": "ã€Šäººç±»ç®€å²ã€‹",
    "currentAccuracy": 0.9,
    "correctCount": 18,
    "totalCount": 20,
    "progress": {
      "highestAccuracy": 0.9,
      "totalAttempts": 4,
      "lastAttemptedAt": "2024-01-01T00:00:00Z",
      "corruptionLevel": 0.1
    },
    "isNewRecord": true
  }
}
```

## Project Structure

```
InkyBeanService/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ database.js          # Supabase æ•°æ®åº“é…ç½®
â”œâ”€â”€ middleware/
â”‚   â”œâ”€â”€ auth.js              # JWT è®¤è¯ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ logger.js            # æ—¥å¿—è®°å½•ä¸­é—´ä»¶
â”‚   â””â”€â”€ validation.js        # è¯·æ±‚éªŒè¯ä¸­é—´ä»¶
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ auth.js              # è®¤è¯è·¯ç”±
â”‚   â”œâ”€â”€ books.js             # ä¹¦ç±è·¯ç”±
â”‚   â”œâ”€â”€ progress.js          # è¿›åº¦è·¯ç”±
â”‚   â”œâ”€â”€ coze.js              # Coze AI å¯¹è¯è·¯ç”±
â”‚   â””â”€â”€ user.js              # ç”¨æˆ·è·¯ç”±
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ corruptionCalculator.js  # è…èš€åº¦è®¡ç®—å·¥å…·
â”‚   â””â”€â”€ cozeService.js       # Coze API æœåŠ¡å°è£…
â”œâ”€â”€ migrations/
â”‚   â””â”€â”€ create_themes_table.sql  # æ•°æ®åº“è¿ç§»æ–‡ä»¶
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ books.test.js        # ä¹¦ç±åŠŸèƒ½æµ‹è¯•
â”œâ”€â”€ index.js                 # åº”ç”¨å…¥å£æ–‡ä»¶
â”œâ”€â”€ package.json             # é¡¹ç›®ä¾èµ–é…ç½®
â”œâ”€â”€ .env.example             # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .env.production          # ç”Ÿäº§ç¯å¢ƒé…ç½®
â”œâ”€â”€ backend.md               # åç«¯å¼€å‘æ–‡æ¡£
â”œâ”€â”€ API_DOCUMENTATION.md     # å‰ç«¯æ¥å£æ–‡æ¡£
â”œâ”€â”€ deploy.sh                # éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ deploy-private.sh        # ç§æœ‰ä»“åº“éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ ecosystem.config.js      # PM2 è¿›ç¨‹ç®¡ç†é…ç½®
â”œâ”€â”€ nginx.conf               # Nginx åå‘ä»£ç†é…ç½®
â”œâ”€â”€ cozeController.ts        # Coze æ§åˆ¶å™¨ï¼ˆTypeScriptï¼‰
â””â”€â”€ test-two-stage-generation.js  # ä¸¤é˜¶æ®µç”Ÿæˆæµ‹è¯•è„šæœ¬
```

### æ–‡ä»¶è¯´æ˜

#### æ ¸å¿ƒåº”ç”¨æ–‡ä»¶
- **index.js**: Express åº”ç”¨ä¸»å…¥å£ï¼Œé…ç½®ä¸­é—´ä»¶å’Œè·¯ç”±
- **package.json**: é¡¹ç›®ä¾èµ–é…ç½®ï¼ŒåŒ…å«æ‰€æœ‰ npm åŒ…å’Œè„šæœ¬

#### é…ç½®æ–‡ä»¶
- **config/database.js**: Supabase å®¢æˆ·ç«¯é…ç½®ï¼ŒåŒ…å«æ™®é€šå®¢æˆ·ç«¯å’Œç®¡ç†å‘˜å®¢æˆ·ç«¯
- **.env.example**: ç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶ï¼Œç”¨äºå¼€å‘ç¯å¢ƒé…ç½®å‚è€ƒ
- **.env.production**: ç”Ÿäº§ç¯å¢ƒé…ç½®æ¨¡æ¿

#### ä¸­é—´ä»¶
- **middleware/auth.js**: JWT ä»¤ç‰ŒéªŒè¯ä¸­é—´ä»¶ï¼Œä¿æŠ¤éœ€è¦è®¤è¯çš„è·¯ç”±
- **middleware/logger.js**: è¯·æ±‚æ—¥å¿—è®°å½•ä¸­é—´ä»¶ï¼Œè®°å½• API è°ƒç”¨ä¿¡æ¯
- **middleware/validation.js**: ä½¿ç”¨ Joi è¿›è¡Œè¯·æ±‚ä½“éªŒè¯

#### è·¯ç”±æ¨¡å—
- **routes/auth.js**: ç”¨æˆ·è®¤è¯ç›¸å…³è·¯ç”±ï¼ˆç™»å½•ã€æ³¨å†Œã€ä»¤ç‰Œåˆ·æ–°ï¼‰
- **routes/books.js**: ä¹¦ç±ç®¡ç†è·¯ç”±ï¼ˆæ·»åŠ ã€è·å–ã€é¢˜ç›®ç”Ÿæˆï¼‰
- **routes/progress.js**: å­¦ä¹ è¿›åº¦è·¯ç”±ï¼ˆè¿›åº¦è®°å½•ã€è…èš€åº¦è®¡ç®—ï¼‰
- **routes/coze.js**: Coze AI å¯¹è¯æ¥å£è·¯ç”±ï¼Œå¤„ç†ä¼šè¯åˆ›å»ºã€æ¶ˆæ¯å‘é€ç­‰åŠŸèƒ½
- **routes/user.js**: ç”¨æˆ·ä¿¡æ¯ç®¡ç†è·¯ç”±

#### å·¥å…·ç±»
- **utils/corruptionCalculator.js**: å®ç°è‰¾å®¾æµ©æ–¯é—å¿˜æ›²çº¿çš„è…èš€åº¦è®¡ç®—ç®—æ³•
- **utils/cozeService.js**: Coze API æœåŠ¡å°è£…ç±»ï¼Œæä¾›ç»Ÿä¸€çš„ API è°ƒç”¨æ¥å£

#### æ•°æ®åº“ç›¸å…³
- **migrations/create_themes_table.sql**: ä¸»é¢˜è¡¨åˆ›å»ºçš„ SQL è¿ç§»æ–‡ä»¶

#### æµ‹è¯•æ–‡ä»¶
- **tests/books.test.js**: ä¹¦ç±åŠŸèƒ½çš„å•å…ƒæµ‹è¯•
- **test-two-stage-generation.js**: ä¸¤é˜¶æ®µ AI ç”ŸæˆåŠŸèƒ½çš„æµ‹è¯•è„šæœ¬

#### éƒ¨ç½²å’Œè¿ç»´
- **deploy.sh**: è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬ï¼ŒåŒ…å«ä»£ç æ‹‰å–ã€ä¾èµ–å®‰è£…ã€æœåŠ¡é‡å¯
- **deploy-private.sh**: ç§æœ‰ä»“åº“çš„éƒ¨ç½²è„šæœ¬
- **ecosystem.config.js**: PM2 è¿›ç¨‹ç®¡ç†é…ç½®ï¼Œç”¨äºç”Ÿäº§ç¯å¢ƒè¿›ç¨‹ç®¡ç†
- **nginx.conf**: Nginx åå‘ä»£ç†é…ç½®ï¼ŒåŒ…å«è´Ÿè½½å‡è¡¡å’Œ SSL é…ç½®

#### æ–‡æ¡£
- **backend.md**: åç«¯å¼€å‘æ–‡æ¡£ï¼ˆæœ¬æ–‡æ¡£ï¼‰ï¼Œé¢å‘åç«¯å¼€å‘è€…
- **API_DOCUMENTATION.md**: å‰ç«¯æ¥å£æ–‡æ¡£ï¼Œé¢å‘å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ
- **PRIVATE_REPO_SETUP.md**: ç§æœ‰ä»“åº“è®¾ç½®æŒ‡å—

#### å…¶ä»–
- **cozeController.ts**: Coze æ§åˆ¶å™¨çš„ TypeScript ç‰ˆæœ¬ï¼ˆå®éªŒæ€§ï¼‰

## AIé¢˜ç›®ç”Ÿæˆç³»ç»Ÿ

### ä¸¤é˜¶æ®µç”Ÿæˆæ¶æ„

Cobeané‡‡ç”¨åˆ›æ–°çš„ä¸¤é˜¶æ®µAIç”Ÿæˆæ¶æ„ï¼Œç¡®ä¿é¢˜ç›®çš„é«˜è´¨é‡å’Œå¤šæ ·æ€§ï¼š

#### é˜¶æ®µ1ï¼šä¸»é¢˜æå–ä¸ç”Ÿæˆ
- **è¾“å…¥**: ä¹¦ç±æ ‡é¢˜ã€ä½œè€…ã€ç°æœ‰ä¸»é¢˜åˆ—è¡¨
- **å¤„ç†**: DeepSeek AIåˆ†æä¹¦ç±æ ¸å¿ƒå†…å®¹ï¼Œç”Ÿæˆæ–°çš„ä¸»é¢˜
- **è¾“å‡º**: 3-5ä¸ªæ ¸å¿ƒä¸»é¢˜æ–‡æœ¬
- **å»é‡**: è‡ªåŠ¨è¿‡æ»¤ä¸ç°æœ‰ä¸»é¢˜é‡å¤çš„å†…å®¹

#### é˜¶æ®µ2ï¼šè§’åº¦åŒ–é¢˜ç›®ç”Ÿæˆ
- **è§’åº¦åˆ†é…**: åç«¯éšæœºä¸ºæ¯ä¸ªä¸»é¢˜åˆ†é…åˆ›æ„è§’åº¦ï¼š
  - å®è·µåº”ç”¨ (practical_application)
  - æ‰¹åˆ¤æ€§æ€è€ƒ (critical_thinking)  
  - æ¦‚å¿µç†è§£ (conceptual_understanding)
  - å†å²å¯¹æ¯” (historical_comparison)
  - ç°å®å…³è” (real_world_connection)
- **é¢˜ç›®ç”Ÿæˆ**: åŸºäºä¸»é¢˜+è§’åº¦ç»„åˆç”Ÿæˆå…·ä½“åˆ¤æ–­é¢˜
- **è´¨é‡ä¿è¯**: æ¯é“é¢˜åŒ…å«å‡†ç¡®çš„è§£é‡Šå’Œæ¨ç†è¿‡ç¨‹

### AIæœåŠ¡é…ç½®

```javascript
// DeepSeek API é…ç½®
const DEEPSEEK_CONFIG = {
  apiUrl: process.env.DEEPSEEK_API_URL,
  apiKey: process.env.DEEPSEEK_API_KEY,
  model: "deepseek-chat",
  timeout: 60000, // 60ç§’è¶…æ—¶
  maxTokens: 2000
};
```

- **APIæä¾›å•†**ï¼šDeepSeek
- **æ¨¡å‹**ï¼šdeepseek-chat
- **è¶…æ—¶è®¾ç½®**ï¼š60ç§’
- **é”™è¯¯å¤„ç†**ï¼šè‡ªåŠ¨é‡è¯•æœºåˆ¶

### æç¤ºè¯å·¥ç¨‹

ç³»ç»Ÿä½¿ç”¨ç²¾å¿ƒè®¾è®¡çš„æç¤ºè¯æ¨¡æ¿ï¼Œç¡®ä¿AIç”Ÿæˆç¬¦åˆè¦æ±‚çš„å†…å®¹ï¼š

- **ä¸»é¢˜ç”Ÿæˆæç¤ºè¯**: å¼•å¯¼AIæå–ä¹¦ç±æ ¸å¿ƒæ¦‚å¿µ
- **é¢˜ç›®ç”Ÿæˆæç¤ºè¯**: åŸºäºä¸»é¢˜å’Œè§’åº¦ç”Ÿæˆåˆ¤æ–­é¢˜
- **æ ¼å¼çº¦æŸ**: ä¸¥æ ¼çš„JSONè¾“å‡ºæ ¼å¼è¦æ±‚
- **è´¨é‡æ ‡å‡†**: æ˜ç¡®çš„é¢˜ç›®è´¨é‡å’Œéš¾åº¦è¦æ±‚

## è…èš€åº¦è®¡ç®—é€»è¾‘

è…èš€åº¦æ˜¯äº§å“çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œæ¨¡æ‹Ÿè‰¾å®¾æµ©æ–¯é—å¿˜æ›²çº¿ï¼š

### åŸºç¡€ç®—æ³•
```javascript
function calculateCorruptionLevel(lastAttemptedAt) {
  // å¦‚æœä»æœªå­¦ä¹ è¿‡ï¼Œè…èš€åº¦ä¸º100%
  if (!lastAttemptedAt) {
    return 1.0;
  }

  const now = new Date();
  const lastAttempt = new Date(lastAttemptedAt);
  
  // è®¡ç®—æ—¶é—´å·®ï¼ˆå°æ—¶ï¼‰
  const hoursPassed = (now.getTime() - lastAttempt.getTime()) / (1000 * 60 * 60);

  // åº”ç”¨é—å¿˜æ›²çº¿å…¬å¼
  // åˆšå®Œæˆæ—¶è…èš€åº¦ä¸º10%ï¼Œæ¯å°æ—¶å¢åŠ 1%ï¼Œæœ€é«˜100%
  const corruptionLevel = Math.min(1.0, 0.1 + (hoursPassed * 0.01));
  
  return Math.round(corruptionLevel * 100) / 100;
}
```

### é«˜çº§ç®—æ³•ï¼ˆå¯é€‰ï¼‰
è€ƒè™‘ç”¨æˆ·æœ€é«˜æ­£ç¡®ç‡çš„å½±å“ï¼š
- æ­£ç¡®ç‡è¶Šé«˜ï¼Œé—å¿˜è¶Šæ…¢
- ä½¿ç”¨æŒ‡æ•°è¡°å‡æ¨¡å‹
- æ›´ç¬¦åˆçœŸå®çš„è®°å¿†é—å¿˜è§„å¾‹

## Setup & Deployment Guide

### ç¯å¢ƒè¦æ±‚
- Node.js >= 16.0.0
- npm >= 8.0.0
- PM2 (ç”Ÿäº§ç¯å¢ƒè¿›ç¨‹ç®¡ç†)
- Nginx (åå‘ä»£ç†)
- Git (ä»£ç æ‹‰å–)
- Supabase é¡¹ç›®

### æœ¬åœ°å¼€å‘è®¾ç½®

1. **å…‹éš†é¡¹ç›®å¹¶å®‰è£…ä¾èµ–**
```bash
cd InkyBeanService
npm install
```

2. **é…ç½®ç¯å¢ƒå˜é‡**
```bash
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥æ­£ç¡®çš„ Supabase é…ç½®
```

3. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**
```bash
npm run dev
```

4. **å¥åº·æ£€æŸ¥**
è®¿é—® `http://localhost:3000/health` ç¡®è®¤æœåŠ¡æ­£å¸¸è¿è¡Œ

### ç”Ÿäº§éƒ¨ç½²

#### æ–¹å¼ä¸€ï¼šä½¿ç”¨è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬

1. **ä½¿ç”¨éƒ¨ç½²è„šæœ¬**
```bash
# èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x deploy.sh

# æ‰§è¡Œéƒ¨ç½²ï¼ˆé¦–æ¬¡éƒ¨ç½²ï¼‰
./deploy.sh --clean-install

# å¸¸è§„éƒ¨ç½²
./deploy.sh

# æŸ¥çœ‹å¸®åŠ©
./deploy.sh --help
```

2. **éƒ¨ç½²è„šæœ¬åŠŸèƒ½**
- è‡ªåŠ¨ä»GitHubæ‹‰å–æœ€æ–°ä»£ç 
- æ£€æŸ¥ç³»ç»Ÿä¾èµ–ï¼ˆgit, node, npm, pm2ï¼‰
- åˆ›å»ºè‡ªåŠ¨å¤‡ä»½
- å®‰è£…/æ›´æ–°ä¾èµ–
- é…ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡
- ä½¿ç”¨PM2å¯åŠ¨æœåŠ¡
- æ‰§è¡Œå¥åº·æ£€æŸ¥
- è‡ªåŠ¨æ¸…ç†æ—§å¤‡ä»½
- æ”¯æŒå›æ»šåŠŸèƒ½

#### æ–¹å¼äºŒï¼šæ‰‹åŠ¨éƒ¨ç½²

1. **å®‰è£…ç³»ç»Ÿä¾èµ–**
```bash
# å®‰è£…Node.jså’Œnpm
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# å®‰è£…PM2
sudo npm install -g pm2

# å®‰è£…Nginx
sudo apt-get install -y nginx
```

2. **é…ç½®ç”Ÿäº§ç¯å¢ƒ**
```bash
# å…‹éš†ä»£ç 
git clone https://github.com/your-username/cobean-ios-backend.git /var/www/cobean-backend
cd /var/www/cobean-backend

# å®‰è£…ä¾èµ–
npm ci --production

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.production .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥æ­£ç¡®çš„é…ç½®
```

3. **é…ç½®PM2**
```bash
# ä½¿ç”¨PM2é…ç½®æ–‡ä»¶å¯åŠ¨
pm2 start ecosystem.config.js --env production

# è®¾ç½®PM2å¼€æœºè‡ªå¯
pm2 startup
pm2 save
```

4. **é…ç½®Nginx**
```bash
# å¤åˆ¶Nginxé…ç½®
sudo cp nginx.conf /etc/nginx/sites-available/cobean-backend

# åˆ›å»ºè½¯é“¾æ¥
sudo ln -s /etc/nginx/sites-available/cobean-backend /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯Nginx
sudo systemctl restart nginx
```

5. **é…ç½®SSLè¯ä¹¦ï¼ˆæ¨èï¼‰**
```bash
# å®‰è£…Certbot
sudo apt-get install -y certbot python3-certbot-nginx

# è·å–SSLè¯ä¹¦
sudo certbot --nginx -d api.cobean.app

# è®¾ç½®è‡ªåŠ¨ç»­æœŸ
sudo crontab -e
# æ·»åŠ ï¼š0 12 * * * /usr/bin/certbot renew --quiet
```

### éƒ¨ç½²æ–‡ä»¶è¯´æ˜

#### deploy.sh
è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬ï¼ŒåŒ…å«ä»¥ä¸‹åŠŸèƒ½ï¼š
- ä»£ç æ‹‰å–å’Œå¤‡ä»½
- ä¾èµ–ç®¡ç†
- ç¯å¢ƒé…ç½®
- æœåŠ¡å¯åŠ¨
- å¥åº·æ£€æŸ¥
- å›æ»šæ”¯æŒ

#### .env.production
ç”Ÿäº§ç¯å¢ƒé…ç½®æ¨¡æ¿ï¼ŒåŒ…å«ï¼š
- æ•°æ®åº“è¿æ¥é…ç½®
- JWTå¯†é’¥é…ç½®
- DeepSeek AIé…ç½®
- å®‰å…¨å’Œç›‘æ§é…ç½®

#### ecosystem.config.js
PM2è¿›ç¨‹ç®¡ç†é…ç½®ï¼ŒåŒ…å«ï¼š
- é›†ç¾¤æ¨¡å¼é…ç½®
- æ—¥å¿—ç®¡ç†
- è‡ªåŠ¨é‡å¯ç­–ç•¥
- æ€§èƒ½ç›‘æ§
- éƒ¨ç½²é…ç½®

#### nginx.conf
Nginxåå‘ä»£ç†é…ç½®ï¼ŒåŒ…å«ï¼š
- è´Ÿè½½å‡è¡¡é…ç½®
- SSL/TLSé…ç½®
- å®‰å…¨å¤´è®¾ç½®
- è¯·æ±‚é™åˆ¶
- é™æ€æ–‡ä»¶æœåŠ¡

### ç›‘æ§å’Œç»´æŠ¤

1. **PM2ç›‘æ§**
```bash
# æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs cobean-backend

# é‡å¯æœåŠ¡
pm2 restart cobean-backend

# ç›‘æ§é¢æ¿
pm2 monit
```

2. **Nginxç›‘æ§**
```bash
# æŸ¥çœ‹NginxçŠ¶æ€
sudo systemctl status nginx

# æŸ¥çœ‹è®¿é—®æ—¥å¿—
sudo tail -f /var/log/nginx/cobean-backend.access.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/cobean-backend.error.log
```

3. **ç³»ç»Ÿç›‘æ§**
```bash
# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
df -h

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
free -h
```

### æ•…éšœæ’é™¤

1. **æœåŠ¡æ— æ³•å¯åŠ¨**
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tlnp | grep :3000

# æ£€æŸ¥PM2æ—¥å¿—
pm2 logs cobean-backend --lines 50

# æ£€æŸ¥ç¯å¢ƒå˜é‡
pm2 env 0
```

2. **æ•°æ®åº“è¿æ¥é—®é¢˜**
```bash
# æµ‹è¯•Supabaseè¿æ¥
curl -H "apikey: YOUR_ANON_KEY" https://your-project.supabase.co/rest/v1/

# æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®
grep SUPABASE .env
```

3. **Nginxé…ç½®é—®é¢˜**
```bash
# æµ‹è¯•Nginxé…ç½®
sudo nginx -t

# é‡æ–°åŠ è½½é…ç½®
sudo nginx -s reload

# æ£€æŸ¥ç«¯å£ç›‘å¬
sudo netstat -tlnp | grep :80
sudo netstat -tlnp | grep :443
```

### Docker éƒ¨ç½²ï¼ˆå¯é€‰ï¼‰

1. **Dockerfile**
```dockerfile
FROM node:18-alpine

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å¤åˆ¶packageæ–‡ä»¶
COPY package*.json ./

# å®‰è£…ä¾èµ–
RUN npm ci --only=production && npm cache clean --force

# å¤åˆ¶æºä»£ç 
COPY . .

# åˆ›å»ºérootç”¨æˆ·
RUN addgroup -g 1001 -S nodejs
RUN adduser -S nodejs -u 1001

# æ›´æ”¹æ–‡ä»¶æ‰€æœ‰æƒ
RUN chown -R nodejs:nodejs /app
USER nodejs

# æš´éœ²ç«¯å£
EXPOSE 3000

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:3000/health || exit 1

# å¯åŠ¨åº”ç”¨
CMD ["npm", "start"]
```

2. **docker-compose.yml**
```yaml
version: '3.8'

services:
  cobean-backend:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
    env_file:
      - .env.production
    restart: unless-stopped
    volumes:
      - ./logs:/app/logs
    networks:
      - cobean-network

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/conf.d/default.conf
      - ./ssl:/etc/nginx/ssl
    depends_on:
      - cobean-backend
    restart: unless-stopped
    networks:
      - cobean-network

networks:
  cobean-network:
    driver: bridge
```

3. **Dockeréƒ¨ç½²å‘½ä»¤**
```bash
# æ„å»ºå’Œå¯åŠ¨
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down

# æ›´æ–°éƒ¨ç½²
docker-compose pull && docker-compose up -d
```

## Security Features

- **Helmet**: è®¾ç½®å®‰å…¨ç›¸å…³çš„ HTTP å¤´
- **CORS**: è·¨åŸŸèµ„æºå…±äº«é…ç½®
- **Rate Limiting**: API è¯·æ±‚é¢‘ç‡é™åˆ¶ï¼ˆ15åˆ†é’Ÿå†…æœ€å¤š100æ¬¡è¯·æ±‚ï¼‰
- **JWT Authentication**: åŸºäºä»¤ç‰Œçš„èº«ä»½éªŒè¯
- **Input Validation**: ä½¿ç”¨ Joi è¿›è¡Œä¸¥æ ¼çš„è¾“å…¥éªŒè¯
- **Environment Variables**: æ•æ„Ÿä¿¡æ¯é€šè¿‡ç¯å¢ƒå˜é‡ç®¡ç†

## Error Handling

æ‰€æœ‰ API å“åº”éƒ½éµå¾ªç»Ÿä¸€çš„é”™è¯¯æ ¼å¼ï¼š

```json
{
  "error": "é”™è¯¯æè¿°",
  "code": "ERROR_CODE",
  "details": [] // å¯é€‰ï¼ŒéªŒè¯é”™è¯¯æ—¶åŒ…å«è¯¦ç»†ä¿¡æ¯
}
```

### å¸¸è§é”™è¯¯ç 
- `MISSING_TOKEN`: ç¼ºå°‘è®¤è¯ä»¤ç‰Œ
- `INVALID_TOKEN`: æ— æ•ˆæˆ–è¿‡æœŸçš„ä»¤ç‰Œ
- `VALIDATION_FAILED`: è¯·æ±‚éªŒè¯å¤±è´¥
- `BOOK_NOT_FOUND`: ä¹¦ç±ä¸å­˜åœ¨
- `RATE_LIMIT_EXCEEDED`: è¯·æ±‚é¢‘ç‡è¶…é™
- `INTERNAL_ERROR`: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

## Changelog

### Version 1.4.0 (2025-01-16)
- âœ… ä¼˜åŒ– POST /books æ¥å£å‚æ•°å’Œå­—æ®µæ˜ å°„
- **æ¥å£ä¼˜åŒ–**:
  1. **ç®€åŒ–è¾“å…¥å‚æ•°**: ç§»é™¤ `author` å‚æ•°è¦æ±‚ï¼Œæ¥å£ç°åœ¨åªéœ€è¦æä¾›ä¹¦å (`title`)
  2. **æ™ºèƒ½ä½œè€…æå–**: ä½œè€…ä¿¡æ¯å®Œå…¨ä» Coze AI è¿”å›æ•°æ®ä¸­æå–ï¼Œå¦‚æœæ²¡æœ‰åˆ™è®¾ä¸º"æœªçŸ¥ä½œè€…"
  3. **ä¿®æ­£å­—æ®µæ˜ å°„**: 
     - `book_image` â†’ `coverImageUrl`ï¼ˆå°é¢å›¾ç‰‡URLï¼‰
     - `summary` â†’ `description`ï¼ˆä¹¦ç±æè¿°ï¼‰
- **ç”¨æˆ·ä½“éªŒæå‡**:
  1. ç”¨æˆ·æ·»åŠ ä¹¦ç±æ—¶åªéœ€è¾“å…¥ä¹¦åï¼Œæ— éœ€æŸ¥æ‰¾ä½œè€…ä¿¡æ¯
  2. AI è‡ªåŠ¨è¡¥å…¨ä¹¦ç±çš„å®Œæ•´ä¿¡æ¯ï¼ˆä½œè€…ã€æè¿°ã€å°é¢ç­‰ï¼‰
  3. æé«˜äº†æ¥å£çš„æ˜“ç”¨æ€§å’Œå‡†ç¡®æ€§
- **æŠ€æœ¯æ”¹è¿›**:
  1. ä¼˜åŒ– Coze è¿”å›æ•°æ®çš„è§£æé€»è¾‘
  2. å¢å¼ºå­—æ®µæ˜ å°„çš„å®¹é”™æ€§ï¼ˆæ”¯æŒå¤šç§å¯èƒ½çš„å­—æ®µåï¼‰
  3. å®Œå–„é”™è¯¯å¤„ç†å’ŒéªŒè¯é€»è¾‘
- **æ–‡æ¡£æ›´æ–°**: 
  1. æ›´æ–° API æ–‡æ¡£ï¼Œåæ˜ æ–°çš„å‚æ•°è¦æ±‚
  2. æ·»åŠ è¯¦ç»†çš„å­—æ®µæ˜ å°„è¯´æ˜
  3. æ›´æ–°å·¥ä½œæµç¨‹æè¿°å’Œç¤ºä¾‹
- **å½±å“**: å¤§å¹…ç®€åŒ–äº†ä¹¦ç±æ·»åŠ æµç¨‹ï¼Œæå‡ç”¨æˆ·ä½“éªŒï¼ŒåŒæ—¶ä¿æŒæ•°æ®å®Œæ•´æ€§

### Version 1.3.1 (2025-01-15)
**æ–°å¢ä¹¦ç±æ·»åŠ æ¥å£**
- **æ–°å¢åŠŸèƒ½**: 
  - æ·»åŠ  `POST /api/books` æ¥å£ï¼Œæ”¯æŒé€šè¿‡ä¹¦åæ·»åŠ æ–°ä¹¦ç±
  - é›†æˆ Coze å·¥ä½œæµ (ID: 7561667870758174763) è·å–ä¹¦ç±è¯¦ç»†ä¿¡æ¯
  - å®ç°ä¹¦ç±é‡å¤æ£€æŸ¥æœºåˆ¶ï¼Œé¿å…é‡å¤æ·»åŠ 
  - æ”¯æŒåŒæ­¥å¤„ç†å’Œç«‹å³å“åº”ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
  - è‡ªåŠ¨è§¦å‘åå°é¢˜ç›®ç”Ÿæˆä»»åŠ¡

- **æŠ€æœ¯å®ç°**:
  - ä½¿ç”¨ Coze æµå¼å·¥ä½œæµæ¥å£è·å–ä¹¦ç±å…ƒæ•°æ®
  - è§£æå¹¶éªŒè¯ Coze è¿”å›çš„ä¹¦ç±ä¿¡æ¯ï¼ˆä¹¦åã€ä½œè€…ã€æè¿°ã€å°é¢ç­‰ï¼‰
  - å®ç°å®Œå–„çš„é”™è¯¯å¤„ç†å’Œå®¹é”™æœºåˆ¶
  - ä½¿ç”¨ `setImmediate` å®ç°å¼‚æ­¥åå°ä»»åŠ¡è§¦å‘

- **æ•°æ®åº“æ‰©å±•**:
  - books è¡¨æ–°å¢å­—æ®µæ”¯æŒï¼šisbnã€publisherã€publishDateã€authorIntroã€url
  - ä¿æŒå‘åå…¼å®¹æ€§ï¼Œæ–°å­—æ®µå…è®¸ä¸ºç©º

- **API æ¥å£**:
  - `POST /api/books` - æ·»åŠ æ–°ä¹¦ç±
  - æ”¯æŒä¹¦ç±é‡å¤æ£€æŸ¥å’Œ Coze å·¥ä½œæµé›†æˆ
  - å®Œå–„çš„é”™è¯¯ç å’Œå“åº”æ ¼å¼

- **æ–‡æ¡£æ›´æ–°**:
  - æ›´æ–° API_DOCUMENTATION.mdï¼Œæ·»åŠ æ–°æ¥å£è¯´æ˜
  - åŒ…å«è¯¦ç»†çš„è¯·æ±‚å‚æ•°ã€å“åº”ç¤ºä¾‹å’Œé”™è¯¯å¤„ç†è¯´æ˜

### Version 1.5.0 (2025-01-15)
- âœ… æ–°å¢å®Œæ•´çš„ç”Ÿäº§éƒ¨ç½²è§£å†³æ–¹æ¡ˆ
- **æ–°å¢åŠŸèƒ½**:
  1. **è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬**: åˆ›å»º `deploy.sh` è„šæœ¬ï¼Œæ”¯æŒä¸€é”®éƒ¨ç½²
  2. **ç”Ÿäº§ç¯å¢ƒé…ç½®**: æä¾› `.env.production` æ¨¡æ¿ï¼ŒåŒ…å«å®Œæ•´çš„ç”Ÿäº§ç¯å¢ƒé…ç½®
  3. **PM2è¿›ç¨‹ç®¡ç†**: é…ç½® `ecosystem.config.js`ï¼Œæ”¯æŒé›†ç¾¤æ¨¡å¼å’Œè‡ªåŠ¨é‡å¯
  4. **Nginxåå‘ä»£ç†**: æä¾›å®Œæ•´çš„ `nginx.conf` é…ç½®ï¼ŒåŒ…å«SSLã€è´Ÿè½½å‡è¡¡å’Œå®‰å…¨è®¾ç½®
- **éƒ¨ç½²è„šæœ¬åŠŸèƒ½**:
  1. è‡ªåŠ¨ä»GitHubæ‹‰å–æœ€æ–°ä»£ç 
  2. ç³»ç»Ÿä¾èµ–æ£€æŸ¥ï¼ˆgit, node, npm, pm2ï¼‰
  3. è‡ªåŠ¨å¤‡ä»½å’Œå›æ»šæœºåˆ¶
  4. ç¯å¢ƒå˜é‡é…ç½®
  5. å¥åº·æ£€æŸ¥å’Œæ—¥å¿—è®°å½•
- **ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–**:
  1. PM2é›†ç¾¤æ¨¡å¼ï¼Œå……åˆ†åˆ©ç”¨å¤šæ ¸CPU
  2. Nginxè´Ÿè½½å‡è¡¡å’Œè¯·æ±‚é™åˆ¶
  3. SSL/TLSå®‰å…¨é…ç½®
  4. æ—¥å¿—ç®¡ç†å’Œç›‘æ§
  5. è‡ªåŠ¨é‡å¯å’Œæ•…éšœæ¢å¤
- **Dockeræ”¯æŒ**:
  1. ä¼˜åŒ–çš„Dockerfileé…ç½®
  2. docker-compose.ymlç¼–æ’æ–‡ä»¶
  3. å¥åº·æ£€æŸ¥å’Œå®‰å…¨é…ç½®
- **æ–‡æ¡£æ›´æ–°**:
  1. è¯¦ç»†çš„éƒ¨ç½²æŒ‡å—
  2. ç›‘æ§å’Œç»´æŠ¤è¯´æ˜
  3. æ•…éšœæ’é™¤æŒ‡å—
  4. å®‰å…¨æœ€ä½³å®è·µ
- **å½±å“**: æä¾›äº†å®Œæ•´çš„ç”Ÿäº§éƒ¨ç½²è§£å†³æ–¹æ¡ˆï¼Œå¤§å¹…ç®€åŒ–äº†éƒ¨ç½²æµç¨‹å’Œè¿ç»´ç®¡ç†

### Version 1.4.0 (2025-01-15)
**DeepSeekåƒæ•¸å„ªåŒ–**
- âœ… **PromptAå„ªåŒ–**ï¼šä¸»é¡Œæå–éšæ®µæ¡ç”¨é«˜å‰µé€ åŠ›é…ç½®
  - Temperature: 1.0ï¼ˆç¯„åœ0.9-1.2ï¼‰æœ€å¤§åŒ–å‰µé€ åŠ›ï¼Œå°‹æ‰¾æ–°è§’åº¦
  - Max Tokens: 2048ï¼Œæä¾›å……è¶³çš„tokenç©ºé–“
- âœ… **PromptBå„ªåŒ–**ï¼šå•é¡Œç”Ÿæˆéšæ®µæ¡ç”¨å¹³è¡¡é…ç½®
  - Temperature: 0.7ï¼ˆç¯„åœ0.6-0.8ï¼‰å¹³è¡¡å‰µæ„èˆ‡ç©©å®šï¼Œéµå¾ªæŒ‡ä»¤
  - Max Tokens: 4096ï¼Œæ”¯æŒæ‰¹é‡ç”Ÿæˆæ›´å¤šå…§å®¹

**æŠ€è¡“æ”¹é€²**
- ğŸ”§ **åƒæ•¸åŒ–APIèª¿ç”¨**ï¼š`callDeepSeekAPI`å‡½æ•¸æ”¯æŒå‹•æ…‹åƒæ•¸é…ç½®
- ğŸ”§ **éšæ®µæ€§å„ªåŒ–**ï¼šä¸åŒç”Ÿæˆéšæ®µä½¿ç”¨æœ€é©åˆçš„AIåƒæ•¸
- ğŸ”§ **æ€§èƒ½æå‡**ï¼šæ›´å¤§çš„tokené™åˆ¶æå‡å…§å®¹ç”Ÿæˆè³ªé‡

**é…ç½®èªªæ˜**
- ğŸ“Š **å‰µé€ åŠ›æœ€å¤§åŒ–**ï¼šä¸»é¡Œæå–ä½¿ç”¨é«˜temperatureæ¿€ç™¼å‰µæ–°æ€ç¶­
- ğŸ“Š **ç©©å®šæ€§ä¿è­‰**ï¼šå•é¡Œç”Ÿæˆä½¿ç”¨é©ä¸­temperatureç¢ºä¿æŒ‡ä»¤éµå¾ª
- ğŸ“Š **å®¹é‡æ“´å±•**ï¼šå¢åŠ max_tokensæ”¯æŒæ›´è±å¯Œçš„å…§å®¹ç”Ÿæˆ

**æ¸¬è©¦é©—è­‰**
- âœ… åƒæ•¸å„ªåŒ–å¾Œçš„ç”Ÿæˆæ¸¬è©¦é€šé
- âœ… å…©éšæ®µé…ç½®å”èª¿æ€§é©—è­‰å®Œæˆ
- âœ… ç”Ÿæˆè³ªé‡å’Œç©©å®šæ€§æ¸¬è©¦é€šé

### 2025-01-14 - æ·»åŠ è¯·æ±‚å“åº”æ—¥å¿—åŠŸèƒ½
- **æ–°å¢åŠŸèƒ½**: å®ç°è¯¦ç»†çš„è¯·æ±‚å’Œå“åº”æ—¥å¿—è®°å½•
- **å®ç°å†…å®¹**:
  1. åˆ›å»º `middleware/logger.js` æ—¥å¿—ä¸­é—´ä»¶
  2. è®°å½•è¯·æ±‚ä¿¡æ¯ï¼šæ—¶é—´æˆ³ã€HTTPæ–¹æ³•ã€è·¯å¾„ã€IPåœ°å€ã€è¯·æ±‚å¤´ã€è¯·æ±‚ä½“ï¼ˆæ•æ„Ÿä¿¡æ¯å·²è„±æ•ï¼‰
  3. è®°å½•å“åº”ä¿¡æ¯ï¼šå“åº”æ—¶é—´ã€çŠ¶æ€ç ã€å“åº”æ•°æ®ï¼ˆè¿‡é•¿æ—¶æˆªæ–­ï¼‰
  4. æä¾›çŠ¶æ€åˆ†ç±»ï¼šæˆåŠŸ(2xx)ã€å®¢æˆ·ç«¯é”™è¯¯(4xx)ã€æœåŠ¡å™¨é”™è¯¯(5xx)
  5. é›†æˆåˆ°ä¸»åº”ç”¨ `index.js` ä¸­ï¼Œä½äºbodyè§£æä¸­é—´ä»¶ä¹‹å
- **æµ‹è¯•éªŒè¯**: é€šè¿‡ `/health` å’Œ `/auth/wechat` æ¥å£éªŒè¯æ—¥å¿—åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- **å½±å“**: æå‡ç³»ç»Ÿå¯è§‚æµ‹æ€§ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥å’Œæ€§èƒ½ç›‘æ§

### 2025-01-14 - ä¿®å¤ä¹¦ç±é¢˜ç›®æ¥å£RLSæƒé™é—®é¢˜
- **é—®é¢˜**: `GET /books/:bookId/questions` æ¥å£è¿”å›404é”™è¯¯ï¼Œæç¤º"Book not found or not published"
- **åŸå› **: ä»£ç ä½¿ç”¨æ™®é€š `supabase` å®¢æˆ·ç«¯æŸ¥è¯¢ä¹¦ç±ä¿¡æ¯ï¼Œå—åˆ° Row Level Security (RLS) ç­–ç•¥é™åˆ¶
- **è§£å†³æ–¹æ¡ˆ**:
  1. ä¿®æ”¹ `routes/books.js` ä¸­çš„ä¹¦ç±éªŒè¯æŸ¥è¯¢ï¼Œä½¿ç”¨ `supabaseAdmin` æ›¿ä»£ `supabase`
  2. ä¿®æ”¹é¢˜ç›®æ•°æ®æŸ¥è¯¢ï¼ŒåŒæ ·ä½¿ç”¨ `supabaseAdmin` ç»•è¿‡RLSé™åˆ¶
- **æµ‹è¯•éªŒè¯**: `GET /books/44b16a72-429a-47ab-9fab-7aab94b341c6/questions` ç°åœ¨æ­£ç¡®è¿”å›200çŠ¶æ€ç å’Œé¢˜ç›®æ•°æ®
- **å½±å“**: ä¹¦ç±é¢˜ç›®æ¥å£ç°åœ¨èƒ½æ­£ç¡®è·å–å·²å‘å¸ƒä¹¦ç±çš„é¢˜ç›®åˆ—è¡¨

### 2025-01-14 - æ›´æ–°APIæ–‡æ¡£æ ¼å¼
- **æ›´æ–°å†…å®¹**: 
  1. ä¿®æ­£ `API_DOCUMENTATION.md` ä¸­ `/books/:bookId/questions` æ¥å£çš„å“åº”æ ¼å¼
  2. æ›´æ–°å“åº”ç¤ºä¾‹ï¼Œä½¿ç”¨çœŸå®çš„æ•°æ®åº“æ•°æ®
  3. ä¿®æ­£å­—æ®µè¯´æ˜ï¼Œç§»é™¤ä¸å­˜åœ¨çš„ `options` å­—æ®µ
  4. æ›´æ–°é”™è¯¯ç æè¿°ï¼Œæ˜ç¡®"ä¹¦ç±ä¸å­˜åœ¨æˆ–æœªå‘å¸ƒ"çš„å«ä¹‰
  5. åŒæ­¥æ›´æ–° `backend.md` æ–‡æ¡£ä¸­çš„ç›¸åº”æ¥å£æè¿°
- **å½±å“**: APIæ–‡æ¡£ç°åœ¨å‡†ç¡®åæ˜ å®é™…çš„æ¥å£è¡Œä¸ºå’Œè¿”å›æ ¼å¼

### 2025-01-14 - æ–°å¢AIé¢˜ç›®ç”Ÿæˆæ¥å£
- **æ–°å¢**: `POST /books/:bookId/generate-questions` æ¥å£ï¼Œæ”¯æŒåŸºäºä¹¦ç±å†…å®¹æ™ºèƒ½ç”Ÿæˆé«˜è´¨é‡é¢˜ç›®
- **åŠŸèƒ½ç‰¹æ€§**:
  1. é›†æˆ DeepSeek APIï¼ŒåŸºäºä¹¦ç±æ ‡é¢˜ã€ä½œè€…å’Œç°æœ‰é¢˜ç›®ç”Ÿæˆæ–°é¢˜ç›®
  2. æ™ºèƒ½å»é‡æœºåˆ¶ï¼Œç¡®ä¿ç”Ÿæˆçš„é¢˜ç›®ä¸ç°æœ‰é¢˜ç›®ä¸é‡å¤
  3. é«˜è´¨é‡é¢˜ç›®ç”Ÿæˆï¼ŒåŒ…å«æ ¸å¿ƒæ¦‚å¿µæµ‹è¯•å’Œè¯¦ç»†è§£é‡Š
  4. è‡ªåŠ¨æ’å…¥æ•°æ®åº“å¹¶æ›´æ–°ä¹¦ç±é¢˜ç›®è®¡æ•°
  5. å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- **æŠ€æœ¯å®ç°**:
  - ä½¿ç”¨ Axios è°ƒç”¨ DeepSeek Chat Completions API
  - å®ç° `buildPrompt` å‡½æ•°æ„å»ºä¸Šä¸‹æ–‡æç¤ºè¯
  - å®ç° `callDeepSeekAPI` å‡½æ•°å¤„ç† AI æœåŠ¡è°ƒç”¨
  - æ‰¹é‡æ’å…¥é¢˜ç›®åˆ° `questions` è¡¨
  - è‡ªåŠ¨æ›´æ–° `books` è¡¨çš„ `questionCount` å­—æ®µ
- **ç¯å¢ƒé…ç½®**: æ–°å¢ `DEEPSEEK_API_KEY` å’Œ `DEEPSEEK_API_URL` ç¯å¢ƒå˜é‡
- **æµ‹è¯•è¦†ç›–**: æ·»åŠ åŸºç¡€å•å…ƒæµ‹è¯•éªŒè¯æ¥å£è®¤è¯å’Œå‚æ•°éªŒè¯
- **æ–‡æ¡£æ›´æ–°**: åŒæ­¥æ›´æ–° API_DOCUMENTATION.md å’Œ backend.md
- **å½±å“**: ä¸ºå†…å®¹ç®¡ç†å‘˜æä¾›äº†é«˜æ•ˆçš„é¢˜ç›®ç”Ÿæˆå·¥å…·ï¼Œå¤§å¹…æå‡é¢˜ç›®åˆ›å»ºæ•ˆç‡

### 2025-01-14 - åˆ›å»ºå‰ç«¯æ¥å£æ–‡æ¡£
- **æ–°å¢**: åˆ›å»º `API_DOCUMENTATION.md` æ–‡ä»¶ï¼Œä¸ºå‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆæä¾›è¯¦ç»†çš„æ¥å£è¯´æ˜
- **å†…å®¹åŒ…å«**:
  - å®Œæ•´çš„ API æ¥å£åˆ—è¡¨å’Œä½¿ç”¨æ–¹æ³•
  - è¯¦ç»†çš„è¯·æ±‚/å“åº”ç¤ºä¾‹
  - é”™è¯¯ç è¯´æ˜å’Œå¤„ç†å»ºè®®
  - è…èš€ç­‰çº§è®¡ç®—é€»è¾‘è¯´æ˜
  - JavaScript å’Œ Swift ç¤ºä¾‹ä»£ç 
  - å¼€å‘æ³¨æ„äº‹é¡¹å’Œæœ€ä½³å®è·µ
- **ç›®çš„**: å¸®åŠ©å‰ç«¯å¼€å‘è€…å¿«é€Ÿç†è§£å’Œé›†æˆåç«¯ API

### 2025-10-16 - Coze API ç«¯ç‚¹ä¿®å¤å’Œæ•°æ®åº“å­—æ®µä¼˜åŒ–
- **é—®é¢˜**: POST /books æ¥å£è°ƒç”¨ Coze å·¥ä½œæµå¤±è´¥ï¼Œè¿”å› 404 é”™è¯¯
- **æ ¹æœ¬åŸå› **: 
  1. Coze API å·¥ä½œæµç«¯ç‚¹é”™è¯¯ï¼šä½¿ç”¨äº† `/v1/workflows/runs` è€Œéæ­£ç¡®çš„ `/v1/workflow/run`
  2. ç¼ºå°‘å¿…è¦çš„ `app_id` å‚æ•°
  3. æ•°æ®åº“æ’å…¥æ—¶åŒ…å«äº†ä¸å­˜åœ¨çš„å­—æ®µï¼ˆ`isbn`ã€`publisher`ã€`publishDate`ã€`authorIntro`ã€`url`ï¼‰
- **è§£å†³æ–¹æ¡ˆ**:
  1. **API ç«¯ç‚¹ä¿®å¤**: 
     - ä¿®æ”¹ `utils/cozeService.js` ä¸­çš„ `runWorkflow` æ–¹æ³•
     - æ›´æ­£ç«¯ç‚¹ä» `/v1/workflows/runs` åˆ° `/v1/workflow/run`
     - æ·»åŠ  `app_id: process.env.COZE_APP_ID` å‚æ•°
  2. **ç¯å¢ƒé…ç½®æ›´æ–°**:
     - åœ¨ `.env` æ–‡ä»¶ä¸­æ·»åŠ  `COZE_APP_ID` é…ç½®é¡¹
  3. **æ•°æ®åº“å­—æ®µä¼˜åŒ–**:
     - ä¿®æ”¹ `routes/books.js` ä¸­çš„æ•°æ®åº“æ’å…¥é€»è¾‘
     - ç§»é™¤ä¸å­˜åœ¨çš„å­—æ®µï¼š`isbn`ã€`publisher`ã€`publishDate`ã€`authorIntro`ã€`url`
     - ä¿ç•™æ ¸å¿ƒå­—æ®µï¼š`title`ã€`author`ã€`description`ã€`coverImageUrl`ã€`questionCount`ã€`isPublished`
  4. **æ•°æ®è§£æå¢å¼º**:
     - æ”¹è¿› Coze å·¥ä½œæµå“åº”æ•°æ®çš„è§£æé€»è¾‘
     - æ”¯æŒå¤šç§æ•°æ®æ ¼å¼çš„å…¼å®¹æ€§å¤„ç†
     - å¢å¼ºé”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- **æµ‹è¯•éªŒè¯**: 
  - æˆåŠŸæ·»åŠ ä¹¦ç±ã€Šæ¸¸æˆæ”¹å˜ä¸–ç•Œã€‹
  - Coze å·¥ä½œæµæ­£å¸¸è°ƒç”¨å¹¶è¿”å›ä¹¦ç±ä¿¡æ¯
  - æ•°æ®åº“æ’å…¥æˆåŠŸï¼Œè¿”å›å®Œæ•´çš„ä¹¦ç±å¯¹è±¡
- **å½±å“**: POST /books æ¥å£ç°åœ¨èƒ½æ­£ç¡®é€šè¿‡ Coze AI å·¥ä½œæµè·å–ä¹¦ç±ä¿¡æ¯å¹¶ä¿å­˜åˆ°æ•°æ®åº“

### Version 1.6.0 (2025-01-15)
- âœ… é›†æˆ Coze AI å¯¹è¯åŠŸèƒ½æ¨¡å—
- **æ–°å¢åŠŸèƒ½**:
  1. **Coze AI å¯¹è¯ç³»ç»Ÿ**: å®Œæ•´é›†æˆ Coze å¹³å°çš„ AI å¯¹è¯èƒ½åŠ›
  2. **ä¼šè¯ç®¡ç†**: æ”¯æŒåˆ›å»ºã€è·å–å’Œæ¸…ç©ºç”¨æˆ·ä¼šè¯
  3. **æ™ºèƒ½å¯¹è¯**: æä¾›åŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§å¯¹è¯æ¨¡å¼
  4. **æ¶ˆæ¯è¿½è¸ª**: å®Œæ•´çš„æ¶ˆæ¯å†å²è®°å½•å’ŒçŠ¶æ€æŸ¥è¯¢
  5. **å·¥ä½œæµæ”¯æŒ**: é¢„ç•™ Coze å·¥ä½œæµæ‰§è¡Œæ¥å£
- **æŠ€æœ¯å®ç°**:
  1. **CozeService ç±»**: å°è£…æ‰€æœ‰ Coze API è°ƒç”¨é€»è¾‘
  2. **è·¯ç”±é›†æˆ**: æ–°å¢ `/coze` è·¯ç”±ç»„ï¼ŒåŒ…å«7ä¸ªæ ¸å¿ƒæ¥å£
  3. **ç”¨æˆ·è®¤è¯**: æ‰€æœ‰æ¥å£å‡éœ€è¦ JWT è®¤è¯
  4. **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯åˆ†ç±»å’Œå¼‚å¸¸å¤„ç†æœºåˆ¶
  5. **ä¼šè¯æŒä¹…åŒ–**: åŸºäºç”¨æˆ·IDçš„ä¼šè¯çŠ¶æ€ç®¡ç†
- **API æ¥å£**:
  1. `POST /coze/conversation` - åˆ›å»ºä¼šè¯
  2. `POST /coze/chat` - å‘èµ·å¯¹è¯ï¼ˆå¼‚æ­¥ï¼‰
  3. `POST /coze/chat/complete` - å®Œæ•´å¯¹è¯ï¼ˆåŒæ­¥ï¼‰
  4. `GET /coze/chat/:conversationId/:chatId/status` - è·å–å¯¹è¯çŠ¶æ€
  5. `GET /coze/messages/:conversationId/:chatId` - è·å–æ¶ˆæ¯åˆ—è¡¨
  6. `DELETE /coze/conversation` - æ¸…ç©ºä¼šè¯
  7. `GET /coze/conversation` - è·å–ä¼šè¯ID
- **ç¯å¢ƒé…ç½®**: éœ€è¦é…ç½® COZE_API_KEYã€COZE_BASE_URLã€COZE_BOT_ID ç­‰ç¯å¢ƒå˜é‡
- **æ–‡æ¡£æ›´æ–°**: 
  1. å®Œå–„ API_DOCUMENTATION.mdï¼Œæ·»åŠ è¯¦ç»†çš„ Coze æ¥å£æ–‡æ¡£
  2. æ›´æ–° backend.mdï¼Œè®°å½•æ¶æ„å˜æ›´å’Œé›†æˆè¿‡ç¨‹
  3. æä¾› JavaScript å’Œ Swift ä½¿ç”¨ç¤ºä¾‹
- **ä»£ç ç»“æ„**:
  1. `routes/coze.js`: Express è·¯ç”±æ§åˆ¶å™¨ï¼Œå¤„ç†HTTPè¯·æ±‚
  2. `utils/cozeService.js`: Coze API æœåŠ¡å°è£…ï¼Œç®¡ç†APIè°ƒç”¨å’ŒçŠ¶æ€
  3. `index.js`: é›†æˆ Coze è·¯ç”±åˆ°ä¸»åº”ç”¨
- **å½±å“**: ä¸º InkyBean åº”ç”¨æä¾›äº†å¼ºå¤§çš„ AI å¯¹è¯èƒ½åŠ›ï¼Œæ”¯æŒæ™ºèƒ½é—®ç­”ã€å­¦ä¹ è¾…å¯¼ç­‰åœºæ™¯

### 2025-01-15 - ä¿®å¤ä¹¦ç±åˆ—è¡¨è·å–é—®é¢˜
- **é—®é¢˜**: `GET /books` æ¥å£è¿”å›ç©ºæ•°ç»„ï¼Œæ— æ³•è·å–å·²å‘å¸ƒçš„ä¹¦ç±
- **åŸå› **: 
  1. JWT token ä¸­çš„ç”¨æˆ·IDå­—æ®µæ˜ å°„é”™è¯¯ï¼ˆ`req.user.id` vs `req.user.userId`ï¼‰
  2. Supabase RLS (Row Level Security) ç­–ç•¥é˜»æ­¢äº†æ™®é€šå®¢æˆ·ç«¯è®¿é—® books è¡¨
  3. PostgreSQL å­—æ®µåå¤§å°å†™æ•æ„Ÿé—®é¢˜
- **è§£å†³æ–¹æ¡ˆ**:
  1. ä¿®å¤ `middleware/auth.js` ä¸­çš„ç”¨æˆ·IDå­—æ®µæ˜ å°„ï¼š`req.user.id` â†’ `req.user.userId`
  2. ä¿®å¤ `routes/books.js` ä¸­çš„ç”¨æˆ·IDå¼•ç”¨ï¼š`req.user.id` â†’ `req.user.userId`
  3. ä½¿ç”¨ `supabaseAdmin` å®¢æˆ·ç«¯ç»•è¿‡ RLS ç­–ç•¥è·å–ä¹¦ç±æ•°æ®
  4. ç¡®ä¿å­—æ®µåä½¿ç”¨åŒå¼•å·åŒ…å›´ä»¥å¤„ç†å¤§å°å†™æ•æ„Ÿé—®é¢˜
- **å½±å“**: ä¹¦ç±åˆ—è¡¨æ¥å£ç°åœ¨èƒ½æ­£ç¡®è¿”å›æ‰€æœ‰å·²å‘å¸ƒçš„ä¹¦ç±åŠç”¨æˆ·è¿›åº¦ä¿¡æ¯

### Version 1.0.2 (2024-01-14)
- âœ… ä¿®å¤æ•°æ®åº“è§¦å‘å™¨å­—æ®µåé—®é¢˜
- **é—®é¢˜**: å­¦ä¹ è¿›åº¦æ›´æ–°å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ `record "new" has no field "updated_at"`
- **æ ¹æœ¬åŸå› **: æ•°æ®åº“è§¦å‘å™¨å‡½æ•° `handle_updated_at` ä½¿ç”¨äº†é”™è¯¯çš„å­—æ®µå `updated_at`ï¼Œè€Œå®é™…è¡¨ç»“æ„ä½¿ç”¨çš„æ˜¯ `updatedAt`ï¼ˆcamelCaseï¼‰
- **è§£å†³æ–¹æ¡ˆ**: 
  1. é€šè¿‡ Supabase æŸ¥è¯¢è§¦å‘å™¨å‡½æ•°å®šä¹‰ï¼Œç¡®è®¤å­—æ®µåé—®é¢˜
  2. æ‰§è¡Œæ•°æ®åº“è¿ç§»ï¼Œä¿®å¤è§¦å‘å™¨å‡½æ•°ä½¿ç”¨æ­£ç¡®çš„å­—æ®µå `"updatedAt"`
  3. è§¦å‘å™¨ç°åœ¨èƒ½æ­£ç¡®è‡ªåŠ¨æ›´æ–° `updatedAt` å­—æ®µ
- **å½±å“**: å­¦ä¹ è¿›åº¦æäº¤æ¥å£ç°åœ¨èƒ½æ­£ç¡®åˆ›å»ºå’Œæ›´æ–°ç”¨æˆ·è¿›åº¦è®°å½•

### Version 1.3.0 (2025-01-15)
- âœ… æ–°å¢ä¸»é¢˜æ•°æ®æŒä¹…åŒ–åŠŸèƒ½
- **æ–°å¢åŠŸèƒ½**:
  1. **ä¸»é¢˜æ•°æ®æŒä¹…åŒ–**: AIç”Ÿæˆçš„æ–°ä¸»é¢˜ç°åœ¨ä¼šè‡ªåŠ¨ä¿å­˜åˆ°themesè¡¨ä¸­
  2. **é¢˜ç›®ä¸»é¢˜å…³è”**: questionsè¡¨æ–°å¢themeIdå­—æ®µï¼Œå»ºç«‹é¢˜ç›®ä¸ä¸»é¢˜çš„å…³è”å…³ç³»
  3. **æ•°æ®åº“æ¶æ„ä¼˜åŒ–**: å®Œå–„äº†themeså’Œquestionsè¡¨ä¹‹é—´çš„å¤–é”®å…³ç³»
- **æŠ€æœ¯æ”¹è¿›**:
  1. **æ•°æ®å®Œæ•´æ€§**: é€šè¿‡å¤–é”®çº¦æŸç¡®ä¿æ•°æ®ä¸€è‡´æ€§
  2. **æŸ¥è¯¢æ€§èƒ½**: ä¸ºquestionsè¡¨çš„themeIdå­—æ®µæ·»åŠ ç´¢å¼•
  3. **å…³è”é€»è¾‘**: ä¼˜åŒ–é¢˜ç›®ç”Ÿæˆæ—¶çš„ä¸»é¢˜åˆ†é…ç®—æ³•
- **æ•°æ®åº“å˜æ›´**:
  1. ä¸ºquestionsè¡¨æ·»åŠ themeIdå­—æ®µï¼ˆuuid, foreign keyï¼‰
  2. åˆ›å»ºidx_questions_theme_idç´¢å¼•æå‡æŸ¥è¯¢æ€§èƒ½
  3. å»ºç«‹themesè¡¨ä¸questionsè¡¨çš„å¤–é”®å…³è”
- **APIå“åº”å¢å¼º**:
  1. POST /books/:bookId/generate-questions ç°åœ¨è¿”å›themesInsertedä¿¡æ¯
  2. é¢˜ç›®æ•°æ®åŒ…å«themeIdå­—æ®µï¼Œæ”¯æŒä¸»é¢˜è¿½æº¯
- **æµ‹è¯•éªŒè¯**:
  1. éªŒè¯ä¸»é¢˜ä¿å­˜åŠŸèƒ½æ­£å¸¸å·¥ä½œ
  2. ç¡®è®¤é¢˜ç›®ä¸ä¸»é¢˜çš„æ­£ç¡®å…³è”
  3. æµ‹è¯•æ•°æ®åº“çº¦æŸå’Œç´¢å¼•æ€§èƒ½
- **å½±å“**: å»ºç«‹äº†å®Œæ•´çš„ä¸»é¢˜-é¢˜ç›®å…³è”ä½“ç³»ï¼Œä¸ºåç»­çš„ä¸»é¢˜åˆ†æå’Œä¸ªæ€§åŒ–æ¨èå¥ å®šåŸºç¡€

### Version 1.2.0 (2025-01-15)
- âœ… å®ç°ä¸¤é˜¶æ®µAIé¢˜ç›®ç”Ÿæˆæ¶æ„
- **é‡å¤§æ›´æ–°**: å‡çº§AIé¢˜ç›®ç”Ÿæˆç³»ç»Ÿï¼Œé‡‡ç”¨åˆ›æ–°çš„ä¸¤é˜¶æ®µç”Ÿæˆæ¶æ„
- **æ–°åŠŸèƒ½**:
  1. **é˜¶æ®µ1 - ä¸»é¢˜ç”Ÿæˆ**: åŸºäºä¹¦ç±å†…å®¹å’Œç°æœ‰ä¸»é¢˜ï¼Œä½¿ç”¨DeepSeek AIç”Ÿæˆæ–°çš„æ ¸å¿ƒä¸»é¢˜
  2. **é˜¶æ®µ2 - è§’åº¦åŒ–é¢˜ç›®ç”Ÿæˆ**: ä¸ºæ¯ä¸ªä¸»é¢˜éšæœºåˆ†é…åˆ›æ„è§’åº¦ï¼Œç”Ÿæˆå¤šæ ·åŒ–çš„åˆ¤æ–­é¢˜
  3. **æ™ºèƒ½å»é‡**: è‡ªåŠ¨é¿å…ä¸ç°æœ‰ä¸»é¢˜å’Œé¢˜ç›®çš„é‡å¤
  4. **è´¨é‡ä¿è¯**: æ¯é“é¢˜ç›®åŒ…å«è¯¦ç»†çš„è§£é‡Šå’Œæ¨ç†è¿‡ç¨‹
- **æŠ€æœ¯æ”¹è¿›**:
  1. ä¿®å¤themesè¡¨ç»“æ„ä¸åŒ¹é…é—®é¢˜ï¼Œæ›´æ–°`extractExistingThemes`å‡½æ•°
  2. å¢åŠ APIè°ƒç”¨è¶…æ—¶æ—¶é—´è‡³60ç§’ï¼Œæå‡ç¨³å®šæ€§
  3. å®Œå–„é”™è¯¯å¤„ç†æœºåˆ¶ï¼ŒåŒ…å«è¯¦ç»†çš„é”™è¯¯åˆ†ç±»å’Œæ—¥å¿—
  4. æ›´æ–°SQLè¿ç§»æ–‡ä»¶ï¼Œåæ˜ å®é™…çš„themesè¡¨ç»“æ„
- **åˆ›æ„è§’åº¦ç³»ç»Ÿ**: 
  - å®è·µåº”ç”¨ (practical_application)
  - æ‰¹åˆ¤æ€§æ€è€ƒ (critical_thinking)
  - æ¦‚å¿µç†è§£ (conceptual_understanding)
  - å†å²å¯¹æ¯” (historical_comparison)
  - ç°å®å…³è” (real_world_connection)
- **æµ‹è¯•éªŒè¯**: é€šè¿‡å®Œæ•´çš„ç«¯åˆ°ç«¯æµ‹è¯•ï¼ŒæˆåŠŸç”Ÿæˆ10é“é«˜è´¨é‡é¢˜ç›®
- **æ–‡æ¡£æ›´æ–°**: å®Œå–„backend.mdï¼Œæ·»åŠ AIç”Ÿæˆç³»ç»Ÿè¯¦ç»†è¯´æ˜å’Œå·¥ä½œæµç¨‹
- **å½±å“**: å¤§å¹…æå‡é¢˜ç›®ç”Ÿæˆçš„è´¨é‡ã€å¤šæ ·æ€§å’Œç³»ç»Ÿç¨³å®šæ€§

### Version 1.1.0 (2025-01-15)
- âœ… æ–°å¢AIé¢˜ç›®ç”Ÿæˆæ¥å£ `POST /books/:bookId/generate-questions`
- **åŠŸèƒ½**: ä½¿ç”¨DeepSeek AIä¸ºæŒ‡å®šä¹¦ç±ç”Ÿæˆæ–°çš„åˆ¤æ–­é¢˜
- **ç‰¹æ€§**:
  1. é›†æˆDeepSeek AI APIï¼ŒåŸºäºä¹¦ç±å†…å®¹å’Œç°æœ‰é¢˜ç›®ç”Ÿæˆæ–°é¢˜ç›®
  2. è‡ªåŠ¨é¿å…é‡å¤é¢˜ç›®ï¼Œç¡®ä¿é¢˜ç›®å¤šæ ·æ€§
  3. ç”Ÿæˆçš„é¢˜ç›®åŒ…å«é™ˆè¿°ã€æ­£ç¡®æ€§åˆ¤æ–­å’Œè¯¦ç»†è§£é‡Š
  4. æ”¯æŒæ‰¹é‡ç”Ÿæˆï¼ˆé»˜è®¤5é“é¢˜ç›®ï¼‰
  5. è‡ªåŠ¨æ›´æ–°ä¹¦ç±çš„é¢˜ç›®è®¡æ•°
- **æŠ€æœ¯å®ç°**:
  1. æ·»åŠ DeepSeek APIé…ç½®å’Œè°ƒç”¨å‡½æ•°
  2. å®ç°æ™ºèƒ½æç¤ºè¯å·¥ç¨‹ï¼Œç¡®ä¿AIç”Ÿæˆé«˜è´¨é‡é¢˜ç›®
  3. æ·»åŠ JSONå“åº”è§£æå’Œé”™è¯¯å¤„ç†
  4. å®ç°æ•°æ®åº“äº‹åŠ¡ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- **å®‰å…¨æ€§**: éœ€è¦JWTè®¤è¯ï¼ŒéªŒè¯ç”¨æˆ·èº«ä»½
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯ç ä½“ç³»ï¼ŒåŒ…æ‹¬AIæœåŠ¡é”™è¯¯ã€æ•°æ®æ ¼å¼é”™è¯¯ç­‰
- **å½±å“**: ä¸ºåº”ç”¨æä¾›äº†åŠ¨æ€é¢˜ç›®ç”Ÿæˆèƒ½åŠ›ï¼Œå¤§å¹…æå‡å†…å®¹ä¸°å¯Œåº¦

### Version 1.6.4 (2025-10-16)
- âœ… æ–°å¢ç”¨æˆ·ä¹¦ç±é€‰æ‹©æ¥å£ï¼Œæ”¯æŒç”¨æˆ·ä¸»åŠ¨é€‰æ‹©è¦å·©å›ºçš„ä¹¦ç±
- **æ–°å¢åŠŸèƒ½**:
  1. **POST /books/:bookId/select**: ç”¨æˆ·é€‰æ‹©è¦å·©å›ºçš„ä¹¦ç±æ¥å£
  2. **ç”¨æˆ·ä¹¦ç±ç»‘å®š**: åœ¨ `user_progress` è¡¨ä¸­åˆ›å»ºç”¨æˆ·ä¸ä¹¦ç±çš„ç»‘å®šå…³ç³»
  3. **é‡å¤é€‰æ‹©å¤„ç†**: æ™ºèƒ½å¤„ç†ç”¨æˆ·é‡å¤é€‰æ‹©åŒä¸€ä¹¦ç±çš„æƒ…å†µ
  4. **å®Œæ•´éªŒè¯æœºåˆ¶**: éªŒè¯ä¹¦ç±å­˜åœ¨æ€§ã€å‘å¸ƒçŠ¶æ€å’Œé¢˜ç›®å¯ç”¨æ€§
- **å·¥ä½œæµç¨‹**:
  1. éªŒè¯ä¹¦ç±æ˜¯å¦å­˜åœ¨ä¸”å·²å‘å¸ƒ
  2. æ£€æŸ¥ä¹¦ç±æ˜¯å¦æœ‰å¯ç”¨é¢˜ç›®ï¼ˆquestionCount > 0ï¼‰
  3. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç»é€‰æ‹©è¿‡è¯¥ä¹¦ç±
  4. é¦–æ¬¡é€‰æ‹©æ—¶åˆ›å»ºæ–°çš„ `user_progress` è®°å½•
  5. è¿”å›å®Œæ•´çš„ä¹¦ç±ä¿¡æ¯å’Œç”¨æˆ·è¿›åº¦çŠ¶æ€
- **å“åº”ç‰¹æ€§**:
  - é¦–æ¬¡é€‰æ‹©ï¼šè¿”å›201çŠ¶æ€ç å’Œå®Œæ•´è¿›åº¦ä¿¡æ¯
  - é‡å¤é€‰æ‹©ï¼šè¿”å›200çŠ¶æ€ç å’Œç°æœ‰è®°å½•ä¿¡æ¯
  - åŒ…å« `alreadySelected` å­—æ®µæ ‡è¯†é€‰æ‹©çŠ¶æ€
- **é”™è¯¯å¤„ç†**:
  - `BOOK_NOT_FOUND`: ä¹¦ç±ä¸å­˜åœ¨æˆ–æœªå‘å¸ƒ
  - `NO_QUESTIONS_AVAILABLE`: ä¹¦ç±æš‚æ— é¢˜ç›®
  - `DATABASE_ERROR`: æ•°æ®åº“æŸ¥è¯¢é”™è¯¯
  - `DATABASE_INSERT_ERROR`: è®°å½•åˆ›å»ºå¤±è´¥
- **æµ‹è¯•éªŒè¯**:
  1. æˆåŠŸæµ‹è¯•é¦–æ¬¡é€‰æ‹©ã€Šå¹³å‡¡çš„ä¸–ç•Œã€‹ï¼Œåˆ›å»ºè¿›åº¦è®°å½•
  2. éªŒè¯é‡å¤é€‰æ‹©çš„å¤„ç†é€»è¾‘ï¼Œè¿”å›ç°æœ‰è®°å½•
  3. ç¡®è®¤é”™è¯¯å¤„ç†æœºåˆ¶æ­£å¸¸å·¥ä½œ
- **æ–‡æ¡£æ›´æ–°**:
  1. æ›´æ–° `API_DOCUMENTATION.md`ï¼Œæ·»åŠ è¯¦ç»†çš„æ¥å£è¯´æ˜
  2. æ›´æ–° `backend.md`ï¼Œè®°å½•æ–°å¢åŠŸèƒ½å’Œå·¥ä½œæµç¨‹
- **å½±å“**: ä¸ºç”¨æˆ·æä¾›äº†ä¸»åŠ¨é€‰æ‹©ä¹¦ç±è¿›è¡Œå·©å›ºçš„èƒ½åŠ›ï¼Œå®Œå–„äº†ç”¨æˆ·å­¦ä¹ æµç¨‹çš„èµ·å§‹ç¯èŠ‚

### Version 1.6.3 (2025-10-16)
- âœ… ä¼˜åŒ–å¼‚æ­¥é¢˜ç›®ç”Ÿæˆæœºåˆ¶ï¼Œä»HTTPè°ƒç”¨æ”¹ä¸ºç›´æ¥å‡½æ•°è°ƒç”¨
- **é—®é¢˜**: ä¹¦ç±æ·»åŠ åå¼‚æ­¥è§¦å‘é¢˜ç›®ç”Ÿæˆæ—¶ï¼Œé€šè¿‡HTTPè¯·æ±‚è°ƒç”¨ `/books/:bookId/generate-questions` æ¥å£å­˜åœ¨è®¤è¯é—®é¢˜ï¼Œå¯¼è‡´é¢˜ç›®ç”Ÿæˆå¤±è´¥
- **è§£å†³æ–¹æ¡ˆ**: 
  1. ä» `POST /books/:bookId/generate-questions` è·¯ç”±ä¸­æå–æ ¸å¿ƒé€»è¾‘ï¼Œåˆ›å»ºç‹¬ç«‹çš„ `generateQuestionsForBook()` å‡½æ•°
  2. ä¿®æ”¹ä¹¦ç±æ·»åŠ åçš„å¼‚æ­¥ä»»åŠ¡ï¼Œç›´æ¥è°ƒç”¨ `generateQuestionsForBook()` å‡½æ•°è€Œä¸æ˜¯HTTPè¯·æ±‚
  3. é¿å…äº†JWT tokenä¼ é€’å’Œè®¤è¯çš„å¤æ‚æ€§ï¼Œæé«˜äº†ç³»ç»Ÿå†…éƒ¨è°ƒç”¨çš„å¯é æ€§
  4. ä¿æŒåŸæœ‰APIæ¥å£ä¸å˜ï¼Œç¡®ä¿å¤–éƒ¨è°ƒç”¨å…¼å®¹æ€§
- **æŠ€æœ¯æ”¹è¿›**:
  - æ–°å¢ `generateQuestionsForBook(bookId, bookTitle, bookAuthor)` æ ¸å¿ƒå‡½æ•°
  - å‡½æ•°åŒ…å«å®Œæ•´çš„é¢˜ç›®ç”Ÿæˆæµç¨‹ï¼šä¸»é¢˜ç”Ÿæˆã€è§’åº¦åˆ†é…ã€é¢˜ç›®ç”Ÿæˆã€å»é‡ã€æ•°æ®åº“å­˜å‚¨
  - æ”¹è¿›é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•ï¼Œä¾¿äºè°ƒè¯•å’Œç›‘æ§
- **æµ‹è¯•ç»“æœ**: 
  - ã€Šå¹³å‡¡çš„ä¸–ç•Œã€‹æ·»åŠ åæˆåŠŸç”Ÿæˆ10é“é¢˜ç›®ï¼ŒquestionCountæ­£ç¡®æ›´æ–°
  - ã€Šå›´åŸã€‹ç­‰ä¹¦ç±çš„é¢˜ç›®ç”ŸæˆåŠŸèƒ½æ­£å¸¸è¿è¡Œ
  - å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œç¨³å®šï¼Œæ— è®¤è¯é”™è¯¯
- **å½±å“**: æå‡äº†ç³»ç»Ÿå†…éƒ¨è°ƒç”¨çš„ç¨³å®šæ€§å’Œæ€§èƒ½ï¼Œæ¶ˆé™¤äº†è®¤è¯ç›¸å…³çš„æ½œåœ¨é—®é¢˜

### Version 1.6.2 (2025-10-16)
- âœ… ä¿®å¤ Coze å·¥ä½œæµå“åº”è§£æé—®é¢˜
- **é—®é¢˜**: ä¹¦ç±æ·»åŠ æ—¶ Coze å·¥ä½œæµè¿”å›çš„ä¹¦ç±ä¿¡æ¯æ— æ³•æ­£ç¡®è§£æï¼Œå¯¼è‡´ä½œè€…ã€æè¿°ã€å°é¢å›¾ç‰‡ç­‰å­—æ®µä¸ºç©º
- **è§£å†³æ–¹æ¡ˆ**: 
  1. ä¿®å¤ `books.js` ä¸­ Coze å·¥ä½œæµå“åº”çš„ JSON è§£æé€»è¾‘
  2. æ­£ç¡®å¤„ç†åµŒå¥—çš„ `output` å­—æ®µç»“æ„ï¼š`workflowResponse.data` -> `JSON.parse()` -> `output` å­—æ®µ
  3. æ›´æ–°å­—æ®µæ˜ å°„é€»è¾‘ï¼Œæ”¯æŒ `authors` æ•°ç»„å’Œå•ä¸ª `author` å­—æ®µ
  4. ä¼˜åŒ– `book_name`ã€`summary`ã€`book_image` ç­‰å­—æ®µçš„æå–é€»è¾‘
- **æµ‹è¯•ç»“æœ**: 
  - ã€Š1984ã€‹æˆåŠŸè§£æï¼šä½œè€… "[è‹±] ä¹”æ²»Â·å¥¥å¨å°”"ï¼Œå®Œæ•´æè¿°å’Œå°é¢å›¾ç‰‡
  - ã€Šä¸‰ä½“ã€‹ç­‰å…¶ä»–ä¹¦ç±çš„ Coze å·¥ä½œæµè°ƒç”¨æ­£å¸¸
- **å½±å“**: ä¹¦ç±æ·»åŠ åŠŸèƒ½ç°åœ¨èƒ½æ­£ç¡®ä» Coze å·¥ä½œæµè·å–å¹¶ä¿å­˜å®Œæ•´çš„ä¹¦ç±ä¿¡æ¯

### Version 1.6.1 (2025-01-15)
- âœ… ä¿®å¤ä¹¦ç±åˆ—è¡¨æ¥å£çš„æ•°æ®åº“æŸ¥è¯¢é—®é¢˜
- **é—®é¢˜**: ä¹¦ç±åˆ—è¡¨æ¥å£è¿”å›ç©ºæ•°ç»„ï¼Œæ— æ³•è·å–ä¹¦ç±æ•°æ®
- **è§£å†³æ–¹æ¡ˆ**: 
  1. ä¿®æ”¹æŸ¥è¯¢è¯­å¥ï¼Œæ­£ç¡®å¤„ç† LEFT JOIN å’Œå­—æ®µåˆ«å
  2. ä¿®å¤å­—æ®µåå¤§å°å†™é—®é¢˜ï¼ˆ`bookId` -> `"bookId"`ï¼‰
  3. ä½¿ç”¨ `supabaseAdmin` å®¢æˆ·ç«¯ç»•è¿‡ RLS ç­–ç•¥è·å–ä¹¦ç±æ•°æ®
  4. ç¡®ä¿å­—æ®µåä½¿ç”¨åŒå¼•å·åŒ…å›´ä»¥å¤„ç†å¤§å°å†™æ•æ„Ÿé—®é¢˜
- **å½±å“**: ä¹¦ç±åˆ—è¡¨æ¥å£ç°åœ¨èƒ½æ­£ç¡®è¿”å›æ‰€æœ‰å·²å‘å¸ƒçš„ä¹¦ç±åŠç”¨æˆ·è¿›åº¦ä¿¡æ¯

### Version 1.0.0 (2024-01-14)
- âœ… åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ… å®ç°ç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼ˆæ³¨å†Œ/ç™»å½•ï¼‰
- âœ… å®ç°ä¹¦ç±ç®¡ç†æ¥å£
- âœ… å®ç°é¢˜ç›®è·å–æ¥å£ï¼ˆå«éšæœºæ’åºï¼‰
- âœ… å®ç°å­¦ä¹ è¿›åº¦è·Ÿè¸ª
- âœ… å®ç°è…èš€åº¦è®¡ç®—ç®—æ³•ï¼ˆåŸºäºè‰¾å®¾æµ©æ–¯é—å¿˜æ›²çº¿ï¼‰
- âœ… æ·»åŠ å®‰å…¨ä¸­é—´ä»¶ï¼ˆHelmet, CORS, Rate Limitingï¼‰
- âœ… æ·»åŠ è¾“å…¥éªŒè¯å’Œé”™è¯¯å¤„ç†
- âœ… å®Œå–„é¡¹ç›®æ–‡æ¡£

### å¾…å®ç°åŠŸèƒ½
- [ ] ç”¨æˆ·ä¸ªäººèµ„æ–™ç®¡ç†
- [ ] ä¹¦ç±æ”¶è—åŠŸèƒ½
- [ ] å­¦ä¹ ç»Ÿè®¡å’Œåˆ†æ
- [ ] æ¨é€é€šçŸ¥
- [ ] ç®¡ç†å‘˜åå°æ¥å£
- [ ] æ•°æ®å¯¼å…¥/å¯¼å‡ºåŠŸèƒ½
- [ ] ç¼“å­˜ä¼˜åŒ–
- [ ] æ—¥å¿—ç³»ç»Ÿ
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–

---

**æœ€åæ›´æ–°**: 2025-10-16

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.6.3  
**ç»´æŠ¤è€…**: InkyBean å¼€å‘å›¢é˜Ÿ